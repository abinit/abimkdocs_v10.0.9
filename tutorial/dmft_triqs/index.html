
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Abinit documentation">
      
      
        <meta name="author" content="ECastiel">
      
      
        <link rel="canonical" href="https://docs.abinit.org/tutorial/dmft_triqs/">
      
      
        <link rel="prev" href="../dmft/">
      
      
        <link rel="next" href="../tddft/">
      
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.43">
    
    
      
        <title>DMFT with TRIQS/CT-HYB - abinit</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
    
      
    

    <!--
    IMPORTANT: Don't use boostrap in particular boostrap.css since it comes into conflict with mkdocs-material theme.
    Prefer low-level tools based on Jquery or JS library such as Tippyjs to get the work done.
    -->

    <!-- Jquery from Google CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Load Jquery UI -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- Handle jQuery plugin naming conflict between jQuery UI and Bootstrap
    https://stackoverflow.com/questions/13731400/jqueryui-tooltips-are-competing-with-twitter-bootstrap
    <script>
      $.widget.bridge('uibutton', $.ui.button);
      $.widget.bridge('uitooltip', $.ui.tooltip);
    </script>
    -->

    <!-- jQuery Modal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

    <!-- Tippyjs for popovers https://atomiks.github.io/tippyjs/ -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <!-- font-awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!--Pace support. http://github.hubspot.com/pace/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/white/pace-theme-big-counter.min.css" />

    <script>
        paceOptions = {
            ajax: true,      // disabled
            document: true,  // activated
            eventLag: false  // disabled
            //target: 'article'
            //elements: {selectors: ['.my-page']}
        };
    </script>

    <!-- MathJax support
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    -->

    <!-- This version is compatible with plotly. -->
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">
    </script>

    <!-- Configure MathJax to produce automatic equation numbers http://docs.mathjax.org/en/latest/tex.html -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        //jax: ["input/TeX","output/HTML-CSS"],
        //tex2jax: {inlineMath: [['$','$']]},
        //displayAlign: "center",
        TeX: {
            equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "boldsymbol.js"],
            Macros: {
                "*": "{\\dagger}",
                "ra": "{\\rangle}",
                "la": "{\\langle}",
                // Workaround for bm package. See https://github.com/mathjax/MathJax/issues/1219
                bm: ["{\\boldsymbol #1}",1],
                // Mathcal symbols
                mcL: "{\\mathcal{L}}",
                mcG: "{\\mathcal{G}}",
                mcR: "{\\mathcal{R}}",
                mcS: "{\\mathcal{S}}",
                mcC: "{\\mathcal{C}}",
                mcO: "{\\mathcal{O}}",
                // Acronyms
                KS: "{\\text{KS}}",
                eph: "{\\text{e-ph}}",
                ee: "{\\text{e-e}}",
                phph: "{\\text{ph-ph}}",
                FM: "{\\text{FM}}",
                DW: "{\\text{DW}}",
                QP: "{\\text{QP}}",
                BZ: "{\\text{BZ}}",
                sign: "{\\text{sign}}",
                xc: "{\\text{xc}}",
                tchi: "{\\tilde\\chi}",
                // Symbols commonly used (k-points, eigenvalues ...)
                rr: "{\\bf r}",
                RR: "{\\bf R}",
                tt: "{\\bf t}",
                GG: "{\\bf G}",
                bg: "{\\bf g}",
                kk: "{\\bf k}",
                qq: "{\\bf q}",
                kq: "{\\kk + \\qq}",
                qG: "{\\bf q + G}",
                kG: "{\\bf k + G}",
                kmq: "{\\kk - \\qq}",
                kpq: "{\\kk + \\qq}",
                kpG: "{\\kk + \\GG}",
                qpG: "{\\qq + \\GG}",
                nk: "{n \\kk}",
                mk: "{, \\kk}",
                nks: "{n \\kk\\sigma}",
                mks: "{m \\kk\\sigma}",
                enk: "{\\varepsilon_\\nk}",
                emkq: "{\\varepsilon_{m\\kk+\\qq}}",
                qnu: "{\\qq \\nu}",
                wqnu: "{\\omega_{\\qnu}}",
                vnk: "{\\mathbf{v}_{n\\kk}}",
                vmkq: "{\\mathbf{v}_{m\\kk+\\qq}}",
                vnka: "{\\mathrm{v}_{n\\kk,\\alpha}}",
                vnkb: "{\\mathrm{v}_{n\\kk,\\beta}}",
                ef: "{\\varepsilon_F}",
                // EPH quantities
                gkkp: "{g_{mn\\nu}(\\kk,\\qq)}",
                gkq: "{g_{mn\\nu}(\\kk,\\qq)}",
                //\newcommand{\gkkpL}{g_{mn\nu}^\Lc(\kb,\qb)}
                // Many-body theory
                Go: "{G_0}",
                Wo: "{W_0}",
                Ueff: "{U_{\\text{eff}}}",
                Gove: "{\\overline{G}}",
                Gund: "{\\underline{G}}",
                // Greek symbols + tilde version
                ee: "{\\epsilon}",
                tee: "{\\tilde{\\epsilon}}",
                ww: "{\\omega}",
                tww: "{\\tilde\\omega}",
                dd: "{\\,\\text{d}}",
                vxc: "{v_\\xc}",
                // symrel
                Ri: "{\\mcR^{-1}}",
                Rit: "{\\mcR^{-1\\tau}}",
                // symrec
                Si: "{\\mcS^{-1}}}",
                Sit: "{\\Si^\\tau}}",
                // partial and functional derivative.
                PDER: ["{\\dfrac{\\partial #1}{\\partial #2}}", 2],
                FDER: ["{\\dfrac{\\delta #1}{\\delta #2}}", 2],
                // PAW
                tPsi: "{\\tilde\\Psi}",
                tpsi: "{\\tilde\\psi}",
                tPhi: "{\\tilde\\Phi}",
                tphi: "{\\tilde\\phi}",
                tprj: "{\\tilde p}"
            }
          }
      });
    </script>

    

    

    <!-- Load fonts used for input variables -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/gallery.css">
    
      <link rel="stylesheet" href="../../css/my_codehilite.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-on-dftdmft-with-triqsct-hyb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="abinit" class="md-header__button md-logo" aria-label="abinit" data-md-component="logo">
      
  <img src="../../images/logo-abinit-2015.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            abinit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DMFT with TRIQS/CT-HYB
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    github-abinit
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../installation/" class="md-tabs__link">
          
  
  User Guides

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../topics/features/" class="md-tabs__link">
          
  
  Topics

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../variables/" class="md-tabs__link">
          
  
  Variables

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../faq/configuration_and_compilation/" class="md-tabs__link">
          
  
  FAQ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../theory/geometry/" class="md-tabs__link">
          
  
  Theory

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../developers/git_and_gitlab/" class="md-tabs__link">
          
  
  Developers

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../about/release-notes/" class="md-tabs__link">
          
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="abinit" class="md-nav__button md-logo" aria-label="abinit" data-md-component="logo">
      
  <img src="../../images/logo-abinit-2015.png" alt="logo">

    </a>
    abinit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    github-abinit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            User Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
        
          
          <label class="md-nav__link" for="__nav_1_1" id="__nav_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HowTo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_MacOS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MacOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_Ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_CentOS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CentOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_EasyBuild/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EasyBuild
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_gpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPUs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NewUser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/abinit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abinit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/abitk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abitk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/aim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/anaddb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anaddb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/atdep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aTDEP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/cut3d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cut3d
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/fold2bloch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fold2Bloch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/mrgddb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mrgddb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/mrgscr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mrgscr
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/multibinit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multibinit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/optic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/respfn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Respfn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/spacegroup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spacegroup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Topics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topic List
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Abipy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abipy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/APPA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APPA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Artificial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artificial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/aTDEP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aTDEP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/AtomCentered/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AtomCentered
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/AtomManipulator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AtomManipulator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/AtomTypes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AtomTypes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Bader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Band2eps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Band2eps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Berry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Berry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/BandOcc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BandOcc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/BSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BSE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/BoundingProcess/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BoundingProcess
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ConstrainedDFT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ConstrainedDFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ConstrainedPol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ConstrainedPol
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Control/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Coulomb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coulomb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/CrossingBarriers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CrossingBarriers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/CalcUJ/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CalcUJ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/crystal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crystal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DFT%2BU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFT+U
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DeltaSCF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeltaSCF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DensityPotential/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DensityPotential
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dev
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DFPT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DMFT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DMFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DmftTriqsCthyb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DmftTriqsCthyb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DynamicsMultibinit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DynamicsMultibinit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/EffectiveMass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EffectiveMass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/EFG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EFG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Elastic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elastic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElPhonInt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ElPhonInt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElPhonTransport/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ElPhonTransport
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElecDOS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ElecDOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElecBandStructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ElecBandStructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ExtFPMD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ExtFPMD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/FileFormats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FileFormats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/FitProcess/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FitProcess
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ForcesStresses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ForcesStresses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/FrequencyMeshMBPT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FrequencyMeshMBPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GeoConstraints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GeoConstraints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GeoOpt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GeoOpt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GSintroduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GSintroduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GW/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GWR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GWR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GWls/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GWls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Hybrids/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hybrids
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/k-points/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K points
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LatticeModel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LatticeModel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LatticeWannier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LatticeWannier
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LWFModel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LWFModel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LDAminushalf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDAminushalf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LOTF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LOTF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/longwave/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Longwave
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Macroave/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Macroave
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/MagField/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MagField
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/MagMom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MagMom
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/MolecularDynamics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MolecularDynamics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/multidtset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multidtset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/NMR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NMR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/nonlinear/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nonlinear
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Optic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Output/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Output
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/parallelism/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parallelism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PAW/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PAW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PIMD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PIMD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Planewaves/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planewaves
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Phonons/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phonons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PhononBands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PhononBands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PhononWidth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PhononWidth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Polaron/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Polaron
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PortabilityNonRegression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PortabilityNonRegression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/positron/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Positron
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/printing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Printing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PseudosPAW/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PseudosPAW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/q-points/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Q points
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/RandStopPow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RandStopPow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Recursion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recursion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/RPACorrEn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RPACorrEn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/RTTDDFT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RTTDDFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SCFControl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCFControl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SCFAlgorithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCFAlgorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SelfEnergy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SelfEnergy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SmartSymm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SmartSymm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/spinpolarisation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spinpolarisation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SpinDynamicsMultibinit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SpinDynamicsMultibinit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/STM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Susceptibility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Susceptibility
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TDDFT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TDDFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TDepES/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TDepES
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Temperature/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Temperature
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TransPath/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TransPath
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TuningSpeedMem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TuningSpeedMem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Unfolding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unfolding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/UnitCell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UnitCell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/vdw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vdw
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Verification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Verification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Wannier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wannier
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Wavelets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wavelets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/xc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/external_resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External Resources
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Variables
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Variables
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    All Variables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Abinit
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Abinit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/bse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bethe-Salpeter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/dmft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DMFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/eph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Electron-Phonon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/ffield/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Varff
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File-handling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/geo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/gstate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ground-State
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/gw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/gwr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GWR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/internal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/paral/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parallelism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/paw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PAW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/dfpt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/rlx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relaxation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/rttddft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RTTDDFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/vdw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VdW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/w90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wannier90
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/anaddb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anaddb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/atdep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aTDEP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/multibinit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multibinit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/optic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/aim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/external_parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External Parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/varset_stats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statistics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basic tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Basic tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    basic1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    basic2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    basic3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    basic4
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../abinit_build/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ABINIT_build
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paw1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PAW1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../polarization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Polarization & finite field
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rf1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFPT1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rf2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFPT2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basepar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parallelism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ABINIT postprocessors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            ABINIT postprocessors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../atdep1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aTDEP1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cut3d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cut3D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fold2bloch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fold2bloch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    optic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wannier90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wannier90
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../z2pack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Z2pack
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          
          <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DFT beyond basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            DFT beyond basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nuc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    properties at the nucleus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dftu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFT+U
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ucalc_crpa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cRPA U(J)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lruj/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linear Response U(J)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paw2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PAW2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paw3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PAW3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../positron/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    positron
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_12" checked>
        
          
          <label class="md-nav__link" for="__nav_4_12" id="__nav_4_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Many-Body Theory & excitations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_12_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_12">
            <span class="md-nav__icon md-icon"></span>
            Many-Body Theory & excitations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gw1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GW1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gw2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GW2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gwr_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GWR_intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gwr1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GWR1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bethe-Salpeter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dmft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DMFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    DMFT with TRIQS/CT-HYB
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    DMFT with TRIQS/CT-HYB
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-presentation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Presentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-installation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-fatbands-of-fe-within-dft" class="md-nav__link">
    <span class="md-ellipsis">
      4. Fatbands of Fe within DFT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-charge-self-consistent-dftdmft-calculation-on-fe" class="md-nav__link">
    <span class="md-ellipsis">
      5. Charge self-consistent DFT+DMFT calculation on Fe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Charge self-consistent DFT+DMFT calculation on Fe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-correlated-electrons" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 Correlated Electrons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-correlated-orbital" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 Correlated Orbital
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-energy-window" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 Energy window
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-interaction-tensor" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 Interaction tensor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-self-consistent-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      5.5 Self-consistent cycle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56-magnetism" class="md-nav__link">
    <span class="md-ellipsis">
      5.6 Magnetism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57-double-counting" class="md-nav__link">
    <span class="md-ellipsis">
      5.7 Double counting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#58-impurity-solver" class="md-nav__link">
    <span class="md-ellipsis">
      5.8 Impurity solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#59-matsubara-mesh" class="md-nav__link">
    <span class="md-ellipsis">
      5.9 Matsubara Mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#510-ct-qmc-basis" class="md-nav__link">
    <span class="md-ellipsis">
      5.10 CT-QMC basis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#511-ct-hyb-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      5.11 CT-HYB parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-local-hilbert-space" class="md-nav__link">
    <span class="md-ellipsis">
      5.12 Local Hilbert space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-imaginary-time" class="md-nav__link">
    <span class="md-ellipsis">
      5.13 Imaginary time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-compact-representation-of-the-greens-function" class="md-nav__link">
    <span class="md-ellipsis">
      5.14 Compact representation of the Green&rsquo;s function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-self-energy" class="md-nav__link">
    <span class="md-ellipsis">
      5.15 Self-energy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#516-energy-and-number-of-electrons" class="md-nav__link">
    <span class="md-ellipsis">
      5.16 Energy and Number of Electrons
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-analytical-continuation-spectral-functions-and-restarting-a-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      6. Analytical Continuation, Spectral Functions, and Restarting a Calculation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Analytical Continuation, Spectral Functions, and Restarting a Calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-local-spectral-function" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 Local spectral function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-k-resolved-spectral-function-and-restarting-a-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 \(k\)-resolved Spectral Function and Restarting a Calculation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-exact-double-counting-formula-enforcing-stationarity-and-providing-a-custom-orbital" class="md-nav__link">
    <span class="md-ellipsis">
      7. Exact double counting formula, enforcing stationarity, and providing a custom orbital
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Exact double counting formula, enforcing stationarity, and providing a custom orbital">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-fixing-the-dmft-orbital" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 Fixing the DMFT orbital
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-providing-a-custom-orbital" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 Providing a custom orbital
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-activating-the-exact-double-counting-formula" class="md-nav__link">
    <span class="md-ellipsis">
      7.3 Activating the exact double-counting formula
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-entropy-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      8. Entropy calculation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tddft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TDDFT (Casida)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rttddft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RT-TDDFT
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_13" >
        
          
          <label class="md-nav__link" for="__nav_4_13" id="__nav_4_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DFPT & electron-phonon
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_13">
            <span class="md-nav__icon md-icon"></span>
            DFPT & electron-phonon
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../elastic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    elastic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nlo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nonlinear
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lattice_wannier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lattice_wannier
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lw_quad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quadrupoles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eph_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eph_intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eph4mob/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eph for mobilities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eph4zpr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eph for zero-point renormalization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eph4vpq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eph for variational polaron equations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eph_legacy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eph_legacy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eph_tdep_legacy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eph_tdep_legacy
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_14" >
        
          
          <label class="md-nav__link" for="__nav_4_14" id="__nav_4_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Multibinit
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_14">
            <span class="md-nav__icon md-icon"></span>
            Multibinit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multibinit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    introduction to multibinit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lattice_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lattice_model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spin_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    spin_model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lwf_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lwf_model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_15" >
        
          
          <label class="md-nav__link" for="__nav_4_15" id="__nav_4_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced parallelism
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_15">
            <span class="md-nav__icon md-icon"></span>
            Advanced parallelism
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paral_bandpw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    paral_band_PW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paral_gswvl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    paral_wavelets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paral_moldyn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    paral_MD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paral_images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    paral_images
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paral_dfpt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    paral_DFPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paral_mbt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    paral_MBPT
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            FAQ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/configuration_and_compilation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration and compilation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/general_questions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General questions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/pre_and_post_processing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pre/Post processing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/ground_state/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ground state
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/dfpt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/Troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting (old-dokuwiki)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/tuning_abinit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tuning (old-dokuwiki)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Theory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Theory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/geometry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/spherical_harmonics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spherical Harmonics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/wavefunctions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wavefunctions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/noncollinear/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noncollinear
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/pseudopotentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pseudopotentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/mbt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Many-Body Perturbation Theory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/bse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bethe-Salpeter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/documents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/acknowledgments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/bibliography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bibliography
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/acronyms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acronyms
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/git_and_gitlab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git and Gitlab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/developers_howto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HowTo for developers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/abimkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abimkdocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/markdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Markdown
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Test Suite
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Test Suite
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/testsuite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test list
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/testsuite_howto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Suite Howto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/new_testsuite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAML-based test suite Howto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/yaml_tools_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAML-based test suite Python tools and API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/XgType/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XgType
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <label class="md-nav__link" for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pseudos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            Pseudos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp1_info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    psp1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp3_info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    psp3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp45_info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    psp45
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp5spinorbit_info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    psp5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp6_info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    psp6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp8_info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    psp8
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/codestats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code stats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/autoconf_examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autoconf_examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/testlink/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Page for linkcheck
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    About
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/history/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    History
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-presentation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Presentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-installation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-fatbands-of-fe-within-dft" class="md-nav__link">
    <span class="md-ellipsis">
      4. Fatbands of Fe within DFT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-charge-self-consistent-dftdmft-calculation-on-fe" class="md-nav__link">
    <span class="md-ellipsis">
      5. Charge self-consistent DFT+DMFT calculation on Fe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Charge self-consistent DFT+DMFT calculation on Fe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-correlated-electrons" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 Correlated Electrons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-correlated-orbital" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 Correlated Orbital
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-energy-window" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 Energy window
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-interaction-tensor" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 Interaction tensor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-self-consistent-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      5.5 Self-consistent cycle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56-magnetism" class="md-nav__link">
    <span class="md-ellipsis">
      5.6 Magnetism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57-double-counting" class="md-nav__link">
    <span class="md-ellipsis">
      5.7 Double counting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#58-impurity-solver" class="md-nav__link">
    <span class="md-ellipsis">
      5.8 Impurity solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#59-matsubara-mesh" class="md-nav__link">
    <span class="md-ellipsis">
      5.9 Matsubara Mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#510-ct-qmc-basis" class="md-nav__link">
    <span class="md-ellipsis">
      5.10 CT-QMC basis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#511-ct-hyb-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      5.11 CT-HYB parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-local-hilbert-space" class="md-nav__link">
    <span class="md-ellipsis">
      5.12 Local Hilbert space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-imaginary-time" class="md-nav__link">
    <span class="md-ellipsis">
      5.13 Imaginary time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-compact-representation-of-the-greens-function" class="md-nav__link">
    <span class="md-ellipsis">
      5.14 Compact representation of the Green&rsquo;s function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-self-energy" class="md-nav__link">
    <span class="md-ellipsis">
      5.15 Self-energy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#516-energy-and-number-of-electrons" class="md-nav__link">
    <span class="md-ellipsis">
      5.16 Energy and Number of Electrons
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-analytical-continuation-spectral-functions-and-restarting-a-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      6. Analytical Continuation, Spectral Functions, and Restarting a Calculation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Analytical Continuation, Spectral Functions, and Restarting a Calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-local-spectral-function" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 Local spectral function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-k-resolved-spectral-function-and-restarting-a-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 \(k\)-resolved Spectral Function and Restarting a Calculation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-exact-double-counting-formula-enforcing-stationarity-and-providing-a-custom-orbital" class="md-nav__link">
    <span class="md-ellipsis">
      7. Exact double counting formula, enforcing stationarity, and providing a custom orbital
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Exact double counting formula, enforcing stationarity, and providing a custom orbital">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-fixing-the-dmft-orbital" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 Fixing the DMFT orbital
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-providing-a-custom-orbital" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 Providing a custom orbital
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-activating-the-exact-double-counting-formula" class="md-nav__link">
    <span class="md-ellipsis">
      7.3 Activating the exact double-counting formula
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-entropy-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      8. Entropy calculation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

                  

  
  


<h1 id="tutorial-on-dftdmft-with-triqsct-hyb">Tutorial on DFT+DMFT with TRIQS/CT-HYB<a class="headerlink" href="#tutorial-on-dftdmft-with-triqsct-hyb" title="Permanent link">&para;</a></h1>
<h2 id="1-introduction">1. Introduction<a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h2>
<p>In this tutorial, you will learn how to run a DFT+DMFT calculation on iron using the interface
between ABINIT and TRIQS/CT-HYB.
TRIQS/CT-HYB is used as the impurity solver,
while ABINIT drives the calculation and connects to TRIQS/CT-HYB
as an external library.</p>
<p>Before starting, you should already know how to do a basic DFT calculation with ABINIT
(see <a href="/tutorial/base1">basic1</a>, <a href="/tutorial/base2">basic2</a>, <a href="/tutorial/base3">basic3</a>,
and <a href="/tutorial/base4">basic4</a>). It also helps if you are familiar with PAW
(see <a href="/tutorial/paw1">PAW1</a> and <a href="/tutorial/paw2">PAW2</a>) and <a href="/tutorial/dftu">DFT+U</a>.
There is also a tutorial on the ABINIT&rsquo;s internal DMFT solvers (see <a href="/tutorial/dmft">DMFT</a>), but
the two DMFT tutorials are independent.</p>
<p>We also recommend that you are comfortable with TRIQS/CT-HYB, and we will assume you already
have at least a basic idea of how the DFT+DMFT method works.</p>
<p>The whole tutorial should take a few hours to complete.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Supposing you made your own installation of ABINIT, the input files to run the examples
are in the <em>~abinit/tests/</em> directory where <em>~abinit</em> is the <strong>absolute path</strong> of the abinit top-level directory.
If you have NOT made your own install, ask your system administrator where to find the package,
especially the executable and test files.</p>
<p>In case you work on your own PC or workstation, to make things easier, we suggest you define
some handy environment variables by executing the following lines in the terminal:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">ABI_HOME</span><span class="o">=</span>Replace_with_absolute_path_to_abinit_top_level_dir<span class="w"> </span><span class="c1"># Change this line</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$ABI_HOME</span>/src/98_main/:<span class="nv">$PATH</span><span class="w">      </span><span class="c1"># Do not change this line: path to executable</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ABI_TESTS</span><span class="o">=</span><span class="nv">$ABI_HOME</span>/tests/<span class="w">             </span><span class="c1"># Do not change this line: path to tests dir</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ABI_PSPDIR</span><span class="o">=</span><span class="nv">$ABI_TESTS</span>/Pspdir/<span class="w">  </span><span class="c1"># Do not change this line: path to pseudos dir</span>
</code></pre></div>
<p>Examples in this tutorial use these shell variables: copy and paste
the code snippets into the terminal (<strong>remember to set ABI_HOME first!</strong>) or, alternatively,
source the <code>set_abienv.sh</code> script located in the <em>~abinit</em> directory:</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>~abinit/set_abienv.sh
</code></pre></div>
<p>The &lsquo;export PATH&rsquo; line adds the directory containing the executables to your <a href="http://www.linfo.org/path_env_var.html">PATH</a>
so that you can invoke the code by simply typing <em>abinit</em> in the terminal instead of providing the absolute path.</p>
<p>To execute the tutorials, create a working directory (<code>Work*</code>) and
copy there the input files of the lesson.</p>
<p>Most of the tutorials do not rely on parallelism (except specific <a class="wikilink lesson-wikilink" href="/tutorial/basepar">tutorials on parallelism</a>).
However you can run most of the tutorial examples in parallel with MPI, see the <a class="wikilink topic-wikilink" data-tippy-content="How to set parameters for a parallel calculation" data-toggle="popover" href="/topics/parallelism">topic on parallelism</a>.</p>
</div>
<h2 id="2-presentation">2. Presentation<a class="headerlink" href="#2-presentation" title="Permanent link">&para;</a></h2>
<p>ABINIT comes with its own internal DMFT code and solvers, but they are not numerically exact
and rely on the density-density approximation. TRIQS/CT-HYB, on the other hand, can handle the
full interaction Hamiltonian.</p>
<p>Our interface makes it easy to run charge self-consistent DFT+DMFT calculations on real materials
with just a single input file. It is designed to give the accuracy and rigor
needed for computing structural properties, including a stationary DFT+DMFT implementation,
with the computation of the Baym-Kadanoff functional, the use of the exact double counting formula,
and an analytical evaluation of the high-frequency moments of the Green&rsquo;s function in a
self-consistent fashion.
That said, our interface does not handle toy models - TRIQS&rsquo;s Python API and built-in tools
already handle those efficiently.</p>
<p>Even though our interface with TRIQS/CT-HYB roughly follows the internal DMFT implementation
of ABINIT, there are a few important differences in input variables or available features, and
it is more than just swapping out the impurity solver.</p>
<p>The input variables that are specific to the TRIQS/CT-HYB solver start with <code>dmft_triqs_</code>, and
many of them are direct copies of TRIQS/CT-HYB&rsquo;s own API inputs - so if you have used TRIQS
before, you should not get lost.</p>
<p>On the other hand, variables related to ABINIT&rsquo;s internal segment solver start with
<code>dmftctqmc_</code> or <code>dmftqmc_</code>. These don&rsquo;t apply here, so you can safely ignore them for this
tutorial.</p>
<p>Finally, variables that control the self-consistent cycle itself start with <code>dmft_</code>. Most of
these are shared between the internal DMFT and the TRIQS/CT-HYB interface, but some features
are available only in one or the other. The glossary clearly points out when that is the case.</p>
<p>If you want a good overview of all input variables relevant for the TRIQS/CT-HYB interface, we
recommend checking out the dedicated <a class="wikilink topic-wikilink" data-tippy-content="How to perform a DFT+DMFT calculation with TRIQS/CT-HYB" data-toggle="popover" href="/topics/DmftTriqsCthyb">topic</a>. Their detailed documentation
can be found in the DMFT <a class="wikilink" href="/variables/dmft">variable glossary</a>. We highly recommend to check it out
after you finish this, as we only introduce the most important variables in this tutorial.</p>
<h2 id="3-installation">3. Installation<a class="headerlink" href="#3-installation" title="Permanent link">&para;</a></h2>
<p>First, you need to install <a href="https://triqs.github.io/triqs/latest/" target="_blank">TRIQS</a>, and then TRIQS/CT-HYB.
Our interface is compatible with the official version of TRIQS/CT-HYB, which you can find
<a href="https://triqs.github.io/cthyb/latest/" target="_blank">here</a>. At the time of writing, our interface handles
versions <code>3.2.x</code> and <code>3.3.x</code>.</p>
<p>However, the official implementation is not suited for large systems or calculations that require high accuracy,
hence we also provide our internal version, found <a href="https://github.com/ec147/cthyb/tree/develop/" target="_blank">here</a> (download the <code>develop</code> branch).</p>
<p>Install it as you would with the official fork. The installation instructions are indicated on their
<a href="https://triqs.github.io/cthyb/latest/install.html" target="_blank">website</a>.</p>
<p>Our internal version contains additional features which we implemented, meant to reduce the computation time for structural properties
calculations:</p>
<ul>
<li>an improved proposal distribution for the insert/remove moves (<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_pauli_prob">dmft_triqs_pauli_prob</a>)</li>
<li>an improved estimator for the density matrix (<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_time_invariance">dmft_triqs_time_invariance</a>)</li>
<li>the possibility to automatically restart the CT-HYB from the previous configuration, in order to reduce the warmup time (<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_read_ctqmcdata">dmft_triqs_read_ctqmcdata</a>)</li>
</ul>
<p>We highly recommend to use our internal version, as these features are paramount for an accurate calculation of
structural properties.</p>
<p>CT-HYB calculations can be very computationally demanding, so take your time when
compiling and pick an efficient BLAS implementation, as it can make a big difference
in performance.</p>
<p>After that, you need to reconfigure ABINIT to link it with TRIQS. Add the following line to your
<code>.ac9</code> configuration file:</p>
<div class="codehilite"><pre><span></span><code>with_triqs=&quot;yes&quot;
</code></pre></div>

<p>The library should be found automatically if the paths to the TRIQS and
TRIQSCT-HYB libraries are included in your environment variables. If you are using
the complex version of TRIQS/CT-HYB, also add:</p>
<div class="codehilite"><pre><span></span><code>enable_triqs_complex=&quot;yes&quot;
</code></pre></div>

<p>Next, make sure your options are recognized correctly and that ABINIT can
successfully link to TRIQS and compile a test code. When configuring, pay attention
to these lines:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>checking<span class="w"> </span>whether<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>linked<span class="w"> </span>against<span class="w"> </span>the<span class="w"> </span>internal<span class="w"> </span>TRIQS<span class="w"> </span>library...<span class="w"> </span><span class="o">[</span>yes<span class="p">|</span>no<span class="o">]</span>
<span class="w"> </span>checking<span class="w"> </span>whether<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>linked<span class="w"> </span>against<span class="w"> </span>the<span class="w"> </span>official<span class="w"> </span>&gt;<span class="o">=</span><span class="m">3</span>.2.x<span class="w"> </span>TRIQS<span class="w"> </span>API...<span class="w"> </span><span class="o">[</span>yes<span class="p">|</span>no<span class="o">]</span>
</code></pre></div>
<p>and:</p>
<div class="codehilite"><pre><span></span><code>checking whether to enable the complex version of TRIQS... [yes|no]
</code></pre></div>

<p>The first line indicates whether our internal version has been found, and the second line
whether the official version has been found, depending on which you choose to install.</p>
<p>The third line indicates whether or not you are using the complex version of TRIQS/CT-HYB
instead of the real version. Including the imaginary part of the Green&rsquo;s function can be important
in systems with strong spin-orbit coupling, and you can activate it by configuring your TRIQS/CT-HYB
installation with <code>-DHybridisation_is_complex=ON</code> and <code>-DLocal_hamiltonian_is_complex=ON</code>.</p>
<p>This tutorial has been written with the real version of our internal fork.</p>
<p>If something goes wrong at this step, carefully check the <code>config.log</code> file. Ask yourself: Why did the
test code fail to compile ? Was the library found and linked properly ?</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Our interface requires linking to MPI, so make sure that ABINIT uses the MPI wrappers when compiling. You can manually select them with <code>CC=mpicc</code>, <code>CXX=mpicxx</code> and <code>FC=mpif90</code>. When compiling ABINIT with <code>gcc</code>, the following Fortran flags (which can be manually set via <code>FCFLAGS</code>) are required: <code>-ffree-line-length-none</code> and <code>-fallow-argument-mismatch</code>. As we are linking with a C++ code, the Fortran flag <code>-lstdc++</code> is also required, and depending on your MPI library, the <code>-lmpi_cxx</code> flag could also be necessary. For the TRIQS flags (which can be set via <code>TRIQS_LDFLAGS</code>), linking is required to the libraries: <code>-L/path_to_triqs -lcppdlr_c -lh5_c -lnda_c -ltriqs -ltriqs_cthyb_c</code> (assuming all libraries are in the same directory). All of this should be done automatically, but we indicate here how to do it manually in case you encounter some issue.</p>
</div>
<p>As a last resort, if you still can&rsquo;t solve the issue, post a question on the
<a href="https://discourse.abinit.org/" target="_blank">ABINIT user forum</a>.</p>
<p>Once everything is set, simply compile ABINIT.</p>
<h2 id="4-fatbands-of-fe-within-dft">4. Fatbands of Fe within DFT<a class="headerlink" href="#4-fatbands-of-fe-within-dft" title="Permanent link">&para;</a></h2>
<p>Before jumping into the DFT+DMFT calculation for Fe, it is useful to first get some physical insight into
its electronic structure at the DFT level. This will help later when choosing some of the key DMFT
parameters.</p>
<p>We will start by computing the density of states (DOS), the band structure, and the fatbands. A fatband
plot shows how much of a given angular character (like <span class="arithmatex">\(s\)</span>, <span class="arithmatex">\(p\)</span>, or <span class="arithmatex">\(d\)</span>) each Kohn-Sham wavefunction
has for every band and <span class="arithmatex">\(k\)</span>-point - the thicker the line, the stronger that orbital&rsquo;s contribution.</p>
<p>Go to the tutorial input directory, make a new working folder, and copy the first input file:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$ABI_TESTS</span>/tutoparal/Input
mkdir<span class="w"> </span>Work_dmft_triqs
<span class="nb">cd</span><span class="w"> </span>Work_dmft_triqs
cp<span class="w"> </span>../tdmft_triqs_1.abi<span class="w"> </span>.
</code></pre></div>
<div class="text-center"><button id="uuid-a2c050e8-dc04-43b1-9c39-e5c2b0908ec4" class="md-button md-button--secondary"> View tests/tutoparal/Input/tdmft_triqs_1.abi </button></div>
<div id="uuid-01febda5-cada-46c1-817d-7846bf08f3a0" class="my_dialog" title="tests/tutoparal/Input/tdmft_triqs_1.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Multi_dataset parameters</span>
<span class="w"> </span>ndtset<span class="w"> </span><span class="m">2</span><span class="w">       </span><span class="c1"># Two datasets</span>
<span class="w"> </span>jdtset<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w">     </span><span class="c1"># one followed by two</span>
<span class="w"> </span>getden<span class="w"> </span>-1<span class="w">      </span><span class="c1"># Second one takes the density of first</span>

<span class="w"> </span>pawprtvol<span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="c1"># Printing additional information</span>
<span class="w"> </span>prtvol<span class="w"> </span><span class="m">4</span><span class="w">     </span><span class="c1">#</span>

<span class="c1">############################</span>
<span class="c1"># Structural Parameters</span>
<span class="c1">############################</span>
<span class="c1">#Definition of unit cell</span>
<span class="w"> </span>acell<span class="w"> </span><span class="m">3</span>*5.44761<span class="w">       </span><span class="c1"># lattice parameter</span>
<span class="w"> </span>rprim<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="c1"># Primitive cell</span>
<span class="w">        </span><span class="m">0</span>.5<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5
<span class="w">        </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w"> </span>-0.5

<span class="c1">#Definition atom</span>
<span class="w"> </span>ntypat<span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="c1"># number of different types of atoms</span>
<span class="w"> </span>znucl<span class="w"> </span><span class="m">26</span><span class="w">   </span><span class="c1"># z number of atom</span>

<span class="c1">#Definition of the atoms</span>
<span class="w"> </span>natom<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># number of atom</span>
<span class="w"> </span>typat<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># type of atom</span>
<span class="w"> </span>xred<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w">  </span><span class="c1"># reduced coordinates for primitive cell</span>

<span class="c1">#Definition pseudopotentials</span>
<span class="w"> </span>pp_dirpath<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span><span class="w">            </span><span class="c1"># repository with pseudopotentials</span>
<span class="w"> </span>pseudos<span class="w"> </span><span class="s2">&quot;26fe.lda2.paw&quot;</span>

<span class="c1">#Definition of the k-point grid</span>
<span class="w"> </span>kptopt<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>ngkpt<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w">              </span><span class="c1"># Reciprocal space vectors are built from</span>
<span class="w">                          </span><span class="c1"># the rprim parameters. This is the size of the</span>
<span class="w">                          </span><span class="c1"># reciprocal k-points.</span>
<span class="w"> </span>nshiftk<span class="w"> </span><span class="m">2</span><span class="w">                </span><span class="c1"># Convergence of the density with regular shifts.</span>
<span class="w"> </span>shiftk<span class="w"> </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25
<span class="w">       </span>-0.25<span class="w"> </span>-0.25<span class="w"> </span>-0.25

<span class="w"> </span>istwfk<span class="w"> </span>*1

<span class="c1">############################</span>
<span class="c1"># Energy Parameters</span>
<span class="c1">############################</span>

<span class="w"> </span>ecut<span class="w"> </span><span class="m">20</span><span class="w">         </span><span class="c1"># Maximal plane-wave kinetic energy cut-off, in Hartree</span>
<span class="w"> </span>pawecutdg<span class="w"> </span><span class="m">40</span><span class="w">    </span><span class="c1"># PAW: Energy Cutoff for the Double Grid</span>
<span class="w"> </span>nband<span class="w"> </span><span class="m">20</span><span class="w">        </span><span class="c1"># Number of bands</span>
<span class="w"> </span>occopt<span class="w"> </span><span class="m">3</span><span class="w">        </span><span class="c1"># Smearing type</span>
<span class="w"> </span>tsmear<span class="w"> </span><span class="m">300</span><span class="w"> </span>K<span class="w">    </span><span class="c1"># Electronic smearing temperature</span>


<span class="c1">############################</span>
<span class="c1"># DFT Calculation</span>
<span class="c1">############################</span>

<span class="w"> </span>nstep1<span class="w"> </span><span class="m">30</span><span class="w">       </span><span class="c1"># Number of iterations for the DFT convergence</span>
<span class="w"> </span>tolwfr<span class="w"> </span><span class="m">1</span>.0d-10<span class="w">  </span><span class="c1"># Tolerance of the density for DFT convergence</span>

<span class="c1">#Definition of the spin properties</span>
<span class="w"> </span>nsppol<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># No spin-polarization</span>
<span class="w"> </span>nspden<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># No Scalar magnetism</span>
<span class="w"> </span>nspinor<span class="w"> </span><span class="m">1</span><span class="w">    </span><span class="c1"># No Spin-orbit</span>

<span class="w"> </span>prtdos1<span class="w">  </span><span class="m">3</span>
<span class="w"> </span>prtdosm1<span class="w"> </span><span class="m">1</span>

<span class="c1">############################</span>
<span class="c1"># Fatbands Calculation</span>
<span class="c1">############################</span>

<span class="w"> </span>nbandkss2<span class="w"> </span><span class="m">2</span>
<span class="w"> </span>kssform2<span class="w">  </span><span class="m">3</span>
<span class="w"> </span>pawfatbnd2<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># Fatbands, resolved for each angular momentum</span>
<span class="w"> </span>iscf2<span class="w"> </span>-2
<span class="w"> </span>kptopt2<span class="w">  </span>-5<span class="w">  </span><span class="c1"># Band structure: 5 segments</span>
<span class="w"> </span>ndivk2<span class="w">   </span><span class="m">18</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">18</span><span class="w">  </span><span class="c1"># Length of each segment</span>
<span class="w"> </span>kptbounds2<span class="w">       </span><span class="c1"># The 5 segments are connecting 6 points of the</span>
<span class="w">                  </span><span class="c1"># Brillouin zone, given here.</span>
<span class="w">              </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w">  </span><span class="c1"># Gamma</span>
<span class="w">              </span><span class="m">0</span>.0<span class="w"> </span><span class="m">1</span>/2<span class="w"> </span><span class="m">0</span>.0<span class="w">  </span><span class="c1"># N</span>
<span class="w">              </span><span class="m">1</span>/4<span class="w"> </span><span class="m">1</span>/4<span class="w"> </span><span class="m">1</span>/4<span class="w">  </span><span class="c1"># P</span>
<span class="w">              </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w">  </span><span class="c1"># Gamma</span>
<span class="w">             </span>-1/2<span class="w"> </span><span class="m">1</span>/2<span class="w"> </span><span class="m">1</span>/2<span class="w">  </span><span class="c1"># H</span>
<span class="w">              </span><span class="m">0</span>.0<span class="w"> </span><span class="m">1</span>/2<span class="w"> </span><span class="m">0</span>.0<span class="w">  </span><span class="c1"># N</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-01febda5-cada-46c1-817d-7846bf08f3a0", "#uuid-a2c050e8-dc04-43b1-9c39-e5c2b0908ec4") }); </script>

<p>Launch the input file with ABINIT. For the rest of this tutorial, we will run everything on 4 CPUs,
but feel free to use more if you can:</p>
<div class="codehilite"><pre><span></span><code>mpirun -n 4 abinit tdmft_triqs_1.abi &gt; log 2&gt;&amp;1
</code></pre></div>

<p>While it runs, take a look at the input file. It has two datasets:</p>
<ol>
<li>A DFT dataset to compute the DOS and the density.</li>
<li>A non self-consistent dataset to compute the band structure along a specific <span class="arithmatex">\(k\)</span>-path in the
     Brillouin zone (defined by <a class="wikilink codevar-wikilink" href="/variables/gstate#kptbounds">kptbounds</a>).</li>
</ol>
<p>The fatbands are computed using the variable <a class="wikilink codevar-wikilink" href="/variables/paw#pawfatbnd">pawfatbnd</a>. Here, it is set to <span class="arithmatex">\(1\)</span>, meaning fatbands are
computed for each angular momentum <span class="arithmatex">\(l\)</span>. If you want orbitally resolved fatbands, set it to <span class="arithmatex">\(2\)</span> instead.</p>
<p>Once the calculation finishes, you will find:</p>
<ul>
<li>The DOS in the file: <code>tdmft_triqs_1o_DS1_DOS_AT0001</code></li>
<li>The fatbands in files named like: <code>tdmft_triqs_1o_DS2_FATBANDS_at0001_Fe_is1_l000x</code> - one for
    each angular momentum.</li>
</ul>
<p>For Fe, we are mainly interested in the <span class="arithmatex">\(3d\)</span> electrons, since they are the most strongly correlated.</p>
<p>You can plot the results using any plotting software you like - or simply use the provided Python
scripts:</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>../dmft_triqs_scripts/plot_dos.py
python3<span class="w"> </span>../dmft_triqs_scripts/plot_fatbands.py
</code></pre></div>
<p>You should get something like this for the DOS:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/dos.png" /></p>
<p>and this for the <span class="arithmatex">\(d\)</span> fatbands:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/fatbands.png" /></p>
<p>From the DOS, you can see that most of the <span class="arithmatex">\(d\)</span>-electron spectral weight lies close to the Fermi level,
within an energy window of about <span class="arithmatex">\(5\)</span> eV.</p>
<p>From the fatbands, you can tell that while the strongest <span class="arithmatex">\(d\)</span> character is indeed around the Fermi level,
it is not confined to the <span class="arithmatex">\(3d\)</span> bands (bands <span class="arithmatex">\(6-10\)</span>). There is significant hybridization with the <span class="arithmatex">\(4s\)</span>
(band <span class="arithmatex">\(5\)</span>) and <span class="arithmatex">\(4p\)</span> (bands <span class="arithmatex">\(11-13\)</span>) states, and even some weaker but noticeable hybridization with higher
bands.</p>
<p>So when you move to the DMFT calculation, you will need to be careful in selecting which bands to
include, to make sure you capture as much of the <span class="arithmatex">\(d\)</span> spectral weight as possible.</p>
<h2 id="5-charge-self-consistent-dftdmft-calculation-on-fe">5. Charge self-consistent DFT+DMFT calculation on Fe<a class="headerlink" href="#5-charge-self-consistent-dftdmft-calculation-on-fe" title="Permanent link">&para;</a></h2>
<p>We will now walk you through the basics of running a charge self-consistent DFT+DMFT calculation,
using iron as an example. Along the way, we will introduce the main input variables you need to know,
show you how our implementation works, and go over the output files. We will also look at the main
convergence parameters and share some tips on how to choose their values wisely.</p>
<p>Before we start, an important note: do not use the values from our example input file as reference for
your own convergence parameters. We intentionally picked small values here to keep the runtime
reasonable. Our implementation is purposely strict about this - we do not provide default values for
many parameters, because we want users to choose them consciously.</p>
<p>Indeed, we feel that most of the inconsistencies found in DFT+DMFT results across the literature come
from poorly chosen convergence parameters. So, always perform proper convergence tests, and redo them
for each system you study.</p>
<p>Alright, let&rsquo;s dive in. Start by copying the second input file and running it with ABINIT. Feel free
to use more CPUs if you have them available:</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>../tdmft_triqs_2.abi<span class="w"> </span>.
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>abinit<span class="w"> </span>tdmft_triqs_2.abi<span class="w"> </span>&gt;<span class="w"> </span>log2<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</code></pre></div>
<div class="text-center"><button id="uuid-97b924f2-4aca-4870-84db-28c814607843" class="md-button md-button--secondary"> View tests/tutoparal/Input/tdmft_triqs_2.abi </button></div>
<div id="uuid-79812c7c-18bc-4627-a5d0-2b15850713e4" class="my_dialog" title="tests/tutoparal/Input/tdmft_triqs_2.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Multi_dataset parameters</span>
<span class="w"> </span>ndtset<span class="w"> </span><span class="m">2</span><span class="w">       </span><span class="c1"># Two datasets</span>
<span class="w"> </span>jdtset<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w">     </span><span class="c1"># one followed by two</span>
<span class="w"> </span>getden<span class="w"> </span>-1<span class="w">      </span><span class="c1"># Second one takes the density of first</span>

<span class="w"> </span>pawprtvol<span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="c1"># Printing additional information</span>
<span class="w"> </span>prtvol<span class="w"> </span><span class="m">4</span>

<span class="c1">############################</span>
<span class="c1"># Structural Parameters</span>
<span class="c1">############################</span>
<span class="c1">#Definition of unit cell</span>
<span class="w"> </span>acell<span class="w"> </span><span class="m">3</span>*5.44761<span class="w">       </span><span class="c1"># lattice parameter from J Phys. Condens. Matt</span>
<span class="w"> </span>rprim<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="c1"># Primitive cell</span>
<span class="w">        </span><span class="m">0</span>.5<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5
<span class="w">        </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w"> </span>-0.5

<span class="c1">#Definition atom</span>
<span class="w"> </span>ntypat<span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="c1"># number of different types of atoms</span>
<span class="w"> </span>znucl<span class="w"> </span><span class="m">26</span><span class="w">   </span><span class="c1"># z number of atom</span>

<span class="c1">#Definition of the atoms</span>
<span class="w"> </span>natom<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># number of atoms</span>
<span class="w"> </span>typat<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># type of atom</span>
<span class="w"> </span>xred<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w">  </span><span class="c1"># reduced coordinates for primitive cell</span>

<span class="c1">#Definition pseudopotentials</span>
<span class="w"> </span>pp_dirpath<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span><span class="w">            </span><span class="c1"># repository with pseudopotentials</span>
<span class="w"> </span>pseudos<span class="w"> </span><span class="s2">&quot;26fe.lda2.paw&quot;</span>

<span class="c1">#Definition of the k-point grid</span>
<span class="w"> </span>kptopt<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>ngkpt<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w">              </span><span class="c1"># Reciprocal space vectors are built from</span>
<span class="w">                          </span><span class="c1"># the rprim parameters. This is the size of the</span>
<span class="w">                          </span><span class="c1"># reciprocal k-points.</span>
<span class="w"> </span>nshiftk<span class="w"> </span><span class="m">2</span><span class="w">                </span><span class="c1"># Convergence of the density with regular shifts.</span>
<span class="w"> </span>shiftk<span class="w"> </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25
<span class="w">       </span>-0.25<span class="w"> </span>-0.25<span class="w"> </span>-0.25
<span class="w"> </span>istwfk<span class="w"> </span>*1

<span class="c1">############################</span>
<span class="c1"># Energy Parameters</span>
<span class="c1">############################</span>

<span class="w"> </span>ecut<span class="w"> </span><span class="m">20</span><span class="w">         </span><span class="c1"># Maximal plane-wave kinetic energy cut-off, in Hartree</span>
<span class="w"> </span>pawecutdg<span class="w"> </span><span class="m">40</span><span class="w">    </span><span class="c1"># PAW: Energy Cutoff for the Double Grid</span>
<span class="w"> </span>nband<span class="w"> </span><span class="m">20</span><span class="w">        </span><span class="c1"># Number of bands</span>
<span class="w"> </span>occopt<span class="w"> </span><span class="m">3</span><span class="w">        </span><span class="c1"># Smearing type</span>
<span class="w"> </span>tsmear<span class="w"> </span><span class="m">3000</span><span class="w"> </span>K<span class="w">   </span><span class="c1"># Electronic smearing temperature</span>

<span class="c1">############################</span>
<span class="c1"># DFT Calculation</span>
<span class="c1">############################</span>

<span class="w"> </span>nstep1<span class="w"> </span><span class="m">30</span><span class="w">        </span><span class="c1"># Number of iterations for the DFT convergence</span>
<span class="w"> </span>tolvrs1<span class="w"> </span><span class="m">1</span>.0d-12<span class="w">  </span><span class="c1"># Tolerance of the density for DFT convergence</span>

<span class="c1">#Definition of the spin properties</span>
<span class="w"> </span>nsppol<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># Spin polarized</span>
<span class="w"> </span>nspden<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># Collinear magnetism</span>
<span class="w"> </span>nspinor<span class="w"> </span><span class="m">1</span><span class="w">    </span><span class="c1"># No Spin-orbit</span>

<span class="c1">############################</span>
<span class="c1"># DMFT Calculation</span>
<span class="c1">############################</span>

<span class="w"> </span>usedmft2<span class="w">  </span><span class="m">1</span><span class="w">        </span><span class="c1"># DMFT calculation</span>
<span class="w"> </span>nstep2<span class="w">    </span><span class="m">20</span><span class="w">       </span><span class="c1"># Number of iterations for the DFT+DMFT convergence</span>
<span class="w"> </span>nline2<span class="w">    </span><span class="m">10</span><span class="w">       </span><span class="c1"># Number of line minimisations</span>
<span class="w"> </span>nnsclo2<span class="w">   </span><span class="m">10</span><span class="w">       </span><span class="c1"># Number of non-self consistent loops</span>
<span class="w"> </span>tolvrs2<span class="w">   </span><span class="m">1</span>.0d-12<span class="w">  </span><span class="c1"># Tolerance of the density for DFT+DMFT convergence</span>

<span class="c1">#Definition for DMFT loop</span>
<span class="w"> </span>dmftbandi<span class="w"> </span><span class="m">5</span><span class="w">             </span><span class="c1"># First KS band included in the projection for Wannier orbitals</span>
<span class="w"> </span>dmftbandf<span class="w"> </span><span class="m">13</span><span class="w">            </span><span class="c1"># Last KS band included in the projection for Wannier orbitals</span>
<span class="w"> </span>dmft_iter<span class="w"> </span><span class="m">1</span><span class="w">             </span><span class="c1"># Number of iterations of the DMFT part.</span>
<span class="w"> </span>dmft_dc<span class="w">   </span><span class="m">6</span><span class="w">             </span><span class="c1"># AMF double counting</span>
<span class="w"> </span>dmft_prtself<span class="w"> </span><span class="m">0</span><span class="w">          </span><span class="c1"># Do not print self-energy at each iteration</span>
<span class="w"> </span>dmft_prt_maxent<span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="c1"># Do not print files for analytical continuation</span>
<span class="w"> </span>dmft_mxsf<span class="w"> </span><span class="m">1</span>.0<span class="w">           </span><span class="c1"># Mixing parameter for self-energy</span>

<span class="c1">#Definition of impurity solver</span>
<span class="w"> </span>dmft_solv<span class="w"> </span><span class="m">6</span><span class="w">                              </span><span class="c1"># TRIQS/CT-HYB solver in density-density approximation</span>
<span class="w"> </span>dmft_triqs_n_iw<span class="w"> </span><span class="m">500</span><span class="w">                      </span><span class="c1"># Number of Matsubara frequencies</span>
<span class="w"> </span>dmft_triqs_n_tau<span class="w"> </span><span class="m">200</span><span class="w">                     </span><span class="c1"># Number of imaginary time points</span>
<span class="w"> </span>dmft_triqs_n_cycles<span class="w"> </span><span class="m">250</span><span class="w">                  </span><span class="c1"># Number of measurement cycles</span>
<span class="w"> </span>dmft_triqs_n_warmup_cycles_init<span class="w">  </span><span class="m">100</span><span class="w">     </span><span class="c1"># Number of warmup cycles for initial iteration</span>
<span class="w"> </span>dmft_triqs_n_warmup_cycles_restart<span class="w"> </span><span class="m">0</span><span class="w">     </span><span class="c1"># Number of warmup cycles when restarting</span>
<span class="w"> </span>dmft_triqs_length_cycle<span class="w"> </span><span class="m">100</span><span class="w">              </span><span class="c1"># Length of a cycle</span>
<span class="w"> </span>dmft_triqs_basis<span class="w"> </span><span class="m">0</span><span class="w">                       </span><span class="c1"># Basis for CT-QMC</span>
<span class="w"> </span>dmft_triqs_off_diag<span class="w"> </span><span class="m">0</span><span class="w">                    </span><span class="c1"># Neglect off-diagonal elements</span>
<span class="w"> </span>dmft_triqs_dlr_wmax<span class="w"> </span><span class="m">30</span><span class="w"> </span>eV<span class="w">                </span><span class="c1"># Maximal frequency for DLR representation</span>
<span class="w"> </span>dmft_triqs_dlr_epsilon<span class="w"> </span><span class="m">1</span>.d-2<span class="w">             </span><span class="c1"># Accuracy of DLR representation</span>

<span class="c1">#Definition of interaction parameters</span>
<span class="w"> </span>usepawu1<span class="w">    </span><span class="m">4</span>
<span class="w"> </span>usepawu2<span class="w">    </span><span class="m">14</span><span class="w">          </span><span class="c1"># Non-magnetic XC potential</span>
<span class="w"> </span>lpawu<span class="w">       </span><span class="m">2</span><span class="w">           </span><span class="c1"># Angular momentum for the projected Hamiltonian</span>
<span class="w"> </span>upawu1<span class="w">      </span><span class="m">0</span>.00<span class="w"> </span>eV
<span class="w"> </span>upawu2<span class="w">      </span><span class="m">5</span>.5<span class="w">  </span>eV<span class="w">     </span><span class="c1"># Values of U for each angular momentum</span>
<span class="w"> </span>jpawu2<span class="w">      </span><span class="m">0</span>.84<span class="w"> </span>eV<span class="w">     </span><span class="c1"># Values of J</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-79812c7c-18bc-4627-a5d0-2b15850713e4", "#uuid-97b924f2-4aca-4870-84db-28c814607843") }); </script>

<p>This calculation might take a few minutes, so while it runs, let&rsquo;s take a look at the input file and
see what&rsquo;s going on.</p>
<p>A charge self-consistent DFT+DMFT calculation usually consists of two datasets:</p>
<ol>
<li>The first one is a DFT calculation (that should be in principle well converged).</li>
<li>The second one is a DFT+DMFT calculation, which starts from the DFT output density of
     the first dataset.</li>
</ol>
<p>We won&rsquo;t revisit the DFT parameters or how to converge them here - that is already covered in the
DFT tutorials. However, remember that once you include DMFT, you&rsquo;ll likely need to readjust your
parameters and redo your convergence studies. For instance, you will often need to converge your
Kohn-Sham wavefunctions more tightly by increasing <a class="wikilink codevar-wikilink" href="/variables/gstate#nline">nline</a> and <a class="wikilink codevar-wikilink" href="/variables/dev#nnsclo">nnsclo</a>.</p>
<p>Also, the electronic temperature (set via <a class="wikilink codevar-wikilink" href="/variables/gstate#tsmear">tsmear</a><span class="arithmatex">\(=1/\beta\)</span>) becomes much more important when
DMFT is active, since temperature effects are explicitly included in the impurity solver -
unlike in the DFT exchange-correlation functional, where they are usually neglected.</p>
<p>Here, we use a CT-HYB solver, which represents the Green&rsquo;s function <span class="arithmatex">\(G(\tau)\)</span> on the imaginary
time axis, with <span class="arithmatex">\(\tau\)</span> ranging from <span class="arithmatex">\(0\)</span> to <span class="arithmatex">\(\beta\)</span>. Because the impurity problem becomes more
complex as <span class="arithmatex">\(\beta\)</span> increases, we are choosing a high temperature (<a class="wikilink codevar-wikilink" href="/variables/gstate#tsmear">tsmear</a><span class="arithmatex">\(=3000 \, \mathrm{K}\)</span>) to keep
things simpler and faster for this example.</p>
<p>For the second dataset, we start by activating DMFT, setting <a class="wikilink codevar-wikilink" href="/variables/dmft#usedmft">usedmft</a><span class="arithmatex">\(=1\)</span>.</p>
<h3 id="51-correlated-electrons">5.1 Correlated Electrons<a class="headerlink" href="#51-correlated-electrons" title="Permanent link">&para;</a></h3>
<p>Next, we need to choose which angular momentum channel (<span class="arithmatex">\(s\)</span>,<span class="arithmatex">\(p\)</span>,<span class="arithmatex">\(d\)</span>,&hellip;) we want to treat as
correlated within DMFT. Each channel corresponds
to a value of <span class="arithmatex">\(l=0,1,2\)</span>&hellip;, and we select it using the variable <a class="wikilink codevar-wikilink" href="/variables/paw#lpawu">lpawu</a>, just like in
DFT+U.</p>
<p>For each atom type, you specify the value of <span class="arithmatex">\(l\)</span> you want to apply DMFT to, each value being
separated by a whitespace. If you do not
want to apply DMFT on a given atom type, simply set <a class="wikilink codevar-wikilink" href="/variables/paw#lpawu">lpawu</a><span class="arithmatex">\(=-1\)</span> for this type.</p>
<p>Each correlated channel will then correspond to <span class="arithmatex">\(2 \times (2l+1)\)</span> orbitals per correlated
atom - the factor of <span class="arithmatex">\(2\)</span> accounts for spin degeneracy, and the <span class="arithmatex">\(2l+1\)</span> comes from the different
magnetic quantum numbers <span class="arithmatex">\(m = -l,...l\)</span>.
Keep in mind that the complexity of the impurity problem increases exponentially with this
number of orbitals, so choosing your correlated channel wisely is important.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At the moment, only values of <a class="wikilink codevar-wikilink" href="/variables/paw#lpawu">lpawu</a> <span class="arithmatex">\(\le 3\)</span> are supported - anything higher would be computationally impractical anyway. Besides, you can only select one unique value of <a class="wikilink codevar-wikilink" href="/variables/paw#lpawu">lpawu</a> per type of atom.</p>
</div>
<p>In our iron example, the localized orbitals that show strong correlation effects are the <span class="arithmatex">\(3d\)</span>
orbitals. Since there is only one atom type (Fe), we simply set <a class="wikilink codevar-wikilink" href="/variables/paw#lpawu">lpawu</a><span class="arithmatex">\(=2\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the case <a class="wikilink codevar-wikilink" href="/variables/paw#lpawu">lpawu</a><span class="arithmatex">\(=2\)</span>, you can select specific values of <span class="arithmatex">\(m\)</span> with <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_t2g">dmft_t2g</a> (<span class="arithmatex">\(m=-2,-1\)</span> and <span class="arithmatex">\(1\)</span>) and <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_x2my2d">dmft_x2my2d</a> (<span class="arithmatex">\(m=2\)</span>), which is useful for cubic symmetry.</p>
</div>
<h3 id="52-correlated-orbital">5.2 Correlated Orbital<a class="headerlink" href="#52-correlated-orbital" title="Permanent link">&para;</a></h3>
<p>Now that we have defined which angular momentum channel we are treating as correlated, we need
to specify the radial part of the correlated orbital - the reduced radial wavefunction <span class="arithmatex">\(u_l(r)\)</span>.</p>
<p>Our convention for the local orbitals follows ABINIT&rsquo;s internal PAW convention:
<span class="arithmatex">\(\frac{u_l(r)}{r} Y_{lm}(\hat{r})\)</span> where <span class="arithmatex">\(Y_{lm}(\hat{r})\)</span> are real spherical harmonics.</p>
<p>The choice of the radial wavefunction is made through the variable <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a>. For iron, the
<span class="arithmatex">\(3d\)</span> orbitals remain quite localized and keep their atomic character, so we just take the
lowest-energy atomic orbital from the PAW dataset (truncated at the PAW radius). That is the default
choice, <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a><span class="arithmatex">\(=1\)</span>, but you can pick any orbital from your PAW dataset or even provide a
custom one from a file if needed (the latter is explained in section <span class="arithmatex">\(7\)</span> of this tutorial).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>More generally, you should pick a radial orbital that captures as much spectral weight as possible in DMFT, especially near the Fermi level, since that&rsquo;s where electron correlations have the biggest impact.</p>
</div>
<p>When the calculation starts, you can see how the radial orbital is defined in the <code>log2</code> file, right
at the beginning of the self-consistent cycle:</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="o">=====</span><span class="w">  </span>Build<span class="w"> </span>DMFT<span class="w"> </span>radial<span class="w"> </span>orbital<span class="w"> </span><span class="k">for</span><span class="w"> </span>atom<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="nv">1</span><span class="w"> </span><span class="o">========</span>

<span class="w">   </span>Using<span class="w"> </span>atomic<span class="w"> </span>orbital<span class="w"> </span>number<span class="w"> </span><span class="m">1</span><span class="w"> </span>from<span class="w"> </span>PAW<span class="w"> </span>dataset
<span class="w">   </span>Squared<span class="w"> </span>norm<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>DMFT<span class="w"> </span>orbital:<span class="w"> </span><span class="m">0</span>.8514
</code></pre></div>
<p>This lets you check the normalization of the orbital. The radial function <span class="arithmatex">\(u_l(r)\)</span> is also written
to the file <code>tdmft_triqs_2o_DS2_DMFTORBITAL_itypat0001.dat</code>. You can plot it with your favorite tool
 - for instance, all DMFT-related outputs are compatible with <code>xmgrace</code>. If you plot this file, you
should see the <span class="arithmatex">\(3d\)</span> atomic orbital from your PAW dataset, truncated at the PAW radius:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/3d_orbital.png" /></p>
<h3 id="53-energy-window">5.3 Energy window<a class="headerlink" href="#53-energy-window" title="Permanent link">&para;</a></h3>
<p>Unfortunately, we cannot directly compute the lattice Green&rsquo;s function over the full Hilbert space - it
would be far too computationally demanding. Instead, we restrict ourselves to a smaller subspace
<span class="arithmatex">\(\mathcal{H}\)</span>, made up of low-energy basis elements. We then downfold this projected Green&rsquo;s function
onto the local orbitals defined by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a> in order to retrieve the local Green&rsquo;s function.</p>
<p>But notice: this is actually the same as downfolding the full lattice Green&rsquo;s function onto the
projection of <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a> onto <span class="arithmatex">\(\mathcal{H}\)</span>.</p>
<p>Therefore, the DMFT local orbitals that are effectively handled in the code are not exactly the ones
defined by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a>, but rather their projection on <span class="arithmatex">\(\mathcal{H}\)</span>.</p>
<p>In our implementation, the lattice Green&rsquo;s function is represented in the Kohn-Sham basis, and
our low-energy Hilbert space is built from all Kohn-Sham wavefunctions whose band indices fall between
<a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandi">dmftbandi</a> and <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandf">dmftbandf</a> - the range that defines the correlated energy window.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We would like to emphasize, however, that when we compute the trace of the Green&rsquo;s function - for instance, to locate the Fermi level - we include all bands (from <span class="arithmatex">\(1\)</span> to <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a>). This differs from many implementations that limit themselves strictly to the correlated energy window.</p>
</div>
<p>Since Kohn-Sham wavefunctions form a complete basis, you could in theory recover the original orbital
defined by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a> by setting <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandi">dmftbandi</a> to <span class="arithmatex">\(1\)</span> and converging <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandf">dmftbandf</a> to infinity.</p>
<p>The choice of your energy window is therefore critical. It directly governs both the spatial spread of
your orbital and your computation time.</p>
<ul>
<li>A wider energy window yields a more localized orbital, but also increases hybridization with the
    bath. Since we use a hybridization-expansion impurity solver, a larger hybridization significantly
    slows down the solver and the evaluation of the Green&rsquo;s function.</li>
<li>A narrower energy window may leave out part of the spectral weight of your target orbital
    <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a>. In this case, the projected orbital may become too extended, potentially
    overlapping with neighboring atoms. That would violate a key approximation of the method - that
    interatomic elements of the Green&rsquo;s function can be neglected.</li>
</ul>
<p>The latter is extremely important since if this approximation breaks, the very important identity
Downfold(Upfold) = Identity might break down, which can lead to inaccuracies and unstability.
You can check the deviation in the <code>log2</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="o">==</span><span class="w"> </span>Check<span class="w"> </span>downfold<span class="o">(</span>upfold<span class="o">)=</span><span class="nv">identity</span><span class="w"> </span><span class="o">==</span>

---<span class="w"> </span>!WARNING
src_file:<span class="w"> </span>m_matlu.F90
src_line:<span class="w"> </span><span class="m">1373</span>
message:<span class="w"> </span><span class="p">|</span>

<span class="w">    </span>Differences<span class="w"> </span>between<span class="w"> </span>Downfold<span class="o">(</span>Upfold<span class="o">)</span><span class="w"> </span>and
<span class="w">       </span>Identity<span class="w"> </span>is<span class="w"> </span>too<span class="w"> </span>large:
<span class="w">         </span><span class="m">0</span>.1284E-03<span class="w"> </span>is<span class="w"> </span>larger<span class="w"> </span>than<span class="w">  </span><span class="m">0</span>.1000E-03
...
</code></pre></div>
<p>As an exercise, you can check that this deviation becomes lower whenever you increase the energy window.</p>
<p>As shown earlier from the fatband analysis, the main spectral weight for the <span class="arithmatex">\(d\)</span> orbitals lie between
bands <span class="arithmatex">\(5\)</span> and <span class="arithmatex">\(13\)</span>, so we use this as our energy window, though a larger energy window would be ideal to decrease the deviation of
Downfold(Upfold) from the identity.</p>
<p>Once the orbitals have been projected onto this low-energy subspace, they might no longer be orthogonal.
You can inspect this in the <code>log2</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="o">==</span><span class="w"> </span>The<span class="w"> </span>DMFT<span class="w"> </span>orbitals<span class="w"> </span>are<span class="w"> </span>now<span class="w"> </span>projected<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>correlated<span class="w"> </span><span class="nv">bands</span>

<span class="w"> </span><span class="o">==</span><span class="w"> </span>Check:<span class="w"> </span>Downfolded<span class="w"> </span>Occupations<span class="w"> </span>and<span class="w"> </span>Norm<span class="w"> </span>of<span class="w"> </span>unnormalized<span class="w"> </span>projected<span class="w"> </span>orbitals

<span class="w">  </span>------<span class="w"> </span>Symmetrized<span class="w"> </span>Occupations

<span class="w">   </span>-------&gt;<span class="w"> </span>For<span class="w"> </span>Correlated<span class="w"> </span>Atom<span class="w"> </span><span class="m">1</span>

<span class="w">          </span>--<span class="w"> </span>polarization<span class="w"> </span>spin<span class="w"> </span>component<span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="m">0</span>.50385<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">  </span>-0.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.50385<span class="w">  </span>-0.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.45679<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.50385<span class="w">   </span><span class="m">0</span>.00000
<span class="w">       </span>-0.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.45679

<span class="w">  </span>------<span class="w"> </span>Symmetrized<span class="w"> </span>Norm

<span class="w">   </span>-------&gt;<span class="w"> </span>For<span class="w"> </span>Correlated<span class="w"> </span>Atom<span class="w"> </span><span class="m">1</span>

<span class="w">          </span>--<span class="w"> </span>polarization<span class="w"> </span>spin<span class="w"> </span>component<span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="m">0</span>.80454<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.80454<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">  </span>-0.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.80154<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">       </span>-0.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.80454<span class="w">  </span>-0.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">  </span>-0.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.80154
</code></pre></div>
<p>Here, the occupation and overlap matrices are
shown. More generally, all local operators are printed in matrix form in the <code>log</code> file,
sorted by spin and increasing magnetic quantum number <span class="arithmatex">\(m\)</span>.</p>
<p>By default, all quantities are output in the real spherical harmonics (cubic) basis. The only exception
occurs when data is passed to the CT-HYB solver, which requires a rotation to the CT-QMC basis (see
section <span class="arithmatex">\(5.10\)</span>). Wherever a basis change occurs, it is clearly indicated in the
<code>log</code>.</p>
<p>As shown above, the norms of the projected orbitals are slightly below the original atomic value
(which wasn&rsquo;t normalized to begin with). Try increasing <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandf">dmftbandf</a>, and you will see the norms
approach the true atomic value of <span class="arithmatex">\(0.8514\)</span>.</p>
<p>The projected orbitals are next promoted to proper Wannier functions by orthonormalizing them via the scheme specified by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_wanorthnorm">dmft_wanorthnorm</a>.</p>
<h3 id="54-interaction-tensor">5.4 Interaction tensor<a class="headerlink" href="#54-interaction-tensor" title="Permanent link">&para;</a></h3>
<p>In a solid, the correlated electrons do not interact via the bare Coulomb potential - their interaction is screened by all the other electrons in the system. Because of this,
you need to provide the screened interaction tensor <span class="arithmatex">\(U_{ijkl}\)</span>, as DFT+DMFT is not a formalism that allows its computation in an ab-initio way.</p>
<p>In our implementation, we use the Slater parametrization, which expresses the full interaction tensor in terms of just a few Slater integrals <span class="arithmatex">\(F^k\)</span> (<span class="arithmatex">\(k = 2i\)</span>, with <span class="arithmatex">\(i = 0, l\)</span>) by assuming the screened potential to have spherical symmetry.</p>
<p>By default, the ratios <span class="arithmatex">\(F^k / F^2\)</span> (for <span class="arithmatex">\(k \ge 4\)</span>) are kept at their atomic values, which is usually a good approximation for <span class="arithmatex">\(3d\)</span> transition metals and rare-earth elements.
If you want to adjust them manually, you can do so via the variables <a class="wikilink codevar-wikilink" href="/variables/paw#f4of2_sla">f4of2_sla</a> and <a class="wikilink codevar-wikilink" href="/variables/paw#f6of2_sla">f6of2_sla</a>.</p>
<p>Once these ratios are fixed, the two remaining Slater integrals <span class="arithmatex">\(F^0\)</span> and <span class="arithmatex">\(F^2\)</span> can be determined uniquely from the average screened interaction <span class="arithmatex">\(U\)</span> and the screened Hunds exchange <span class="arithmatex">\(J\)</span>.
These parameters have clear physical meanings  <span class="arithmatex">\(U\)</span> sets the overall interaction strength, while <span class="arithmatex">\(J\)</span> controls the tendency of electrons to align their spins.
You can set them for each atom type using <a class="wikilink codevar-wikilink" href="/variables/paw#upawu">upawu</a> and <a class="wikilink codevar-wikilink" href="/variables/paw#jpawu">jpawu</a>.</p>
<p>There are several ways to compute these parameters directly within ABINIT  for example, using <a href="/tutorial/ucalc_crpa">cRPA</a> or <a href="/tutorial/lruj">linear response</a> - but those
are beyond the scope of this tutorial. Here, we will simply treat <span class="arithmatex">\(U\)</span> and <span class="arithmatex">\(J\)</span> as input parameters.</p>
<p>Keep in mind that these are matrix elements of the screened potential, meaning their values depend on the shape of the local orbitals.
So, if you change your energy window, you may need to readjust <span class="arithmatex">\(U\)</span> and <span class="arithmatex">\(J\)</span>.</p>
<p>For this example, we will use the same parameters as in <a class="wikilink citation-wikilink" data-tippy-content="Phonon softening due to melting of the ferromagnetic order in elemental iron" data-toggle="popover" href="/theory/bibliography#han2018">[Han2018]</a> 
<span class="arithmatex">\(U = 5.5\)</span> eV and <span class="arithmatex">\(J = 0.84\)</span> eV  since their chosen energy window is similar to ours.</p>
<h3 id="55-self-consistent-cycle">5.5 Self-consistent cycle<a class="headerlink" href="#55-self-consistent-cycle" title="Permanent link">&para;</a></h3>
<p>A charge self-consistent DFT+DMFT calculation involves two nested loops:</p>
<ul>
<li>The outer DFT+DMFT loop, whose number of iterations is controlled by <a class="wikilink codevar-wikilink" href="/variables/basic#nstep">nstep</a></li>
<li>The inner DMFT loop, whose number of iterations is controlled by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_iter">dmft_iter</a></li>
</ul>
<p>This means the impurity solver is called a total of <a class="wikilink codevar-wikilink" href="/variables/basic#nstep">nstep</a> <span class="arithmatex">\(\times\)</span> <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_iter">dmft_iter</a> times. Each inner DMFT loop is performed at fixed electronic density, and that density gets updated
<a class="wikilink codevar-wikilink" href="/variables/basic#nstep">nstep</a> times in total - once every <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_iter">dmft_iter</a> DMFT iterations.</p>
<p>Heres a schematic showing how the DFT+DMFT self-consistent cycle works:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/dmft_cycle_tuto.png" /></p>
<p>When doing a charge self-consistent calculation, it is usually best to set <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_iter">dmft_iter</a><span class="arithmatex">\(=1\)</span> and only adjust <a class="wikilink codevar-wikilink" href="/variables/basic#nstep">nstep</a> to control convergence speed.
That is because trying to reach self-consistency in the DMFT loop before the charge density converges just wastes time.</p>
<h3 id="56-magnetism">5.6 Magnetism<a class="headerlink" href="#56-magnetism" title="Permanent link">&para;</a></h3>
<p>The next step is to decide what type of magnetism you want to include. Here, we choose <a class="wikilink codevar-wikilink" href="/variables/basic#nsppol">nsppol</a><span class="arithmatex">\(=\)</span><a class="wikilink codevar-wikilink" href="/variables/gstate#nspden">nspden</a><span class="arithmatex">\(=1\)</span>, which enforces a collinear paramagnetic solution by
symmetrizing the two spin channels of the Greens function. Even so, the impurity solver is solved with all spin channels, meaning local magnetic moments can still form.</p>
<p>Collinear magnetism can be enabled with <a class="wikilink codevar-wikilink" href="/variables/basic#nsppol">nsppol</a><span class="arithmatex">\(=\)</span><a class="wikilink codevar-wikilink" href="/variables/gstate#nspden">nspden</a><span class="arithmatex">\(=2\)</span>. In this case, it can sometimes be better to keep the DFT exchange-correlation potential non-magnetic and let magnetism emerge purely from DMFT, as approximate magnetic double counting formula can introduce an artifical spin dependence in the calculation. You can select a non-magnetic XC potential by setting <a class="wikilink codevar-wikilink" href="/variables/paw#usepawu">usepawu</a><span class="arithmatex">\(=10\)</span>. Otherwise, set <a class="wikilink codevar-wikilink" href="/variables/paw#usepawu">usepawu</a><span class="arithmatex">\(=14\)</span> for a magnetic XC potential.</p>
<p>Finally, non-collinear calculations are also supported by our interface (<a class="wikilink codevar-wikilink" href="/variables/gstate#nspinor">nspinor</a><span class="arithmatex">\(=2\)</span> and <a class="wikilink codevar-wikilink" href="/variables/gstate#nspden">nspden</a><span class="arithmatex">\(=4\)</span>).</p>
<h3 id="57-double-counting">5.7 Double counting<a class="headerlink" href="#57-double-counting" title="Permanent link">&para;</a></h3>
<p>When combining DFT and DMFT, you run into the double counting problem - some of the local interactions are already partly included at the DFT level, so they need to be subtracted and
replaced by their exact DMFT values.</p>
<p>ABINIT provides the exact double counting formula, though it is a bit more involved to use, so this is covered in section <span class="arithmatex">\(7\)</span> of this tutorial.</p>
<p>There are also several simpler, commonly used approximate formulas, which you can select using the variable <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_dc">dmft_dc</a>. Here, we choose <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_dc">dmft_dc</a><span class="arithmatex">\(=6\)</span>, corresponding to the AMF correction, better suited for metals.</p>
<h3 id="58-impurity-solver">5.8 Impurity solver<a class="headerlink" href="#58-impurity-solver" title="Permanent link">&para;</a></h3>
<p>We havent yet told ABINIT to use the TRIQS/CT-HYB interface instead of its internal DMFT solvers. This is done with <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_solv">dmft_solv</a>, which sets the impurity solver to be used.</p>
<p>For TRIQS/CT-HYB, there are two relevant options:</p>
<ul>
<li><a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_solv">dmft_solv</a><span class="arithmatex">\(=6\)</span>: Uses TRIQS/CT-HYB but keeps only the density-density terms in the interaction tensor. This is much faster, though if thats what you need, a segment solver would be
      more efficient.</li>
<li><a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_solv">dmft_solv</a><span class="arithmatex">\(=7\)</span>: Uses the full rotationally invariant Slater Hamiltonian, giving the most accurate treatment of interactions.</li>
</ul>
<p>If instead you want to use ABINITs internal DMFT implementation with its built-in solvers, check out the dedicated <a href="/tutorial/dmft">DMFT tutorial</a>.</p>
<h3 id="59-matsubara-mesh">5.9 Matsubara Mesh<a class="headerlink" href="#59-matsubara-mesh" title="Permanent link">&para;</a></h3>
<p>In our implementation, the Greens function is represented in imaginary frequencies as <span class="arithmatex">\(G(i\omega_n)\)</span>, and is computed exactly on the first <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_iw">dmft_triqs_n_iw</a> = <span class="arithmatex">\(n_{i\omega}\)</span> Matsubara frequencies, defined as
\begin{equation*}
    \omega_n = (2n + 1)\frac{\pi}{\beta}
\end{equation*}</p>
<p>During the calculation, several steps require integrating over all Matsubara frequencies.
However, directly summing:
\begin{equation*}
    \sum_{n=-n_{i \omega}}^{n_{i \omega}-1} G(i\omega_n) e^{i 0^{+}}
\end{equation*}
(with <span class="arithmatex">\(e^{i0^+}\)</span> a small damping factor) would be impractical  it would take far too long to converge.</p>
<p>To make this efficient, we use a moment expansion of the Greens function up to fifth order to handle the high-frequency behavior analytically:</p>
<p>\begin{equation*}
    \sum_{n=-\infty}^{\infty} G(i\omega_n) e^{i 0^{+}} \approx \sum_{n=-n_{i\omega}}^{n_{i\omega}-1} \left[ G(i\omega_n) - \sum_{j=1}^{5} \frac{G_j}{(i\omega_n)^j} \right] + \sum_{n=-\infty}^{\infty} \frac{G_j}{(i\omega_n)^j} e^{i 0^{+}}
\end{equation*}
where <span class="arithmatex">\(G_j\)</span> are the moments of the Greens function.</p>
<p>The first term is computed numerically, while the second term is handled analytically.
Since the moments <span class="arithmatex">\(G_j\)</span> are obtained analytically in our implementation,
this approach is both efficient and guaranteed to converge to the exact result.</p>
<p>To ensure consistency, the code automatically compares this summation to the corresponding value for the DFT Greens function, where the sum reduces to a FermiDirac occupation factor.
If the difference is too large, the code stops and raises an error  this is a helpful way to check whether your <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_iw">dmft_triqs_n_iw</a> value is properly chosen.</p>
<p>You can find this check in your <code>log2</code> file. If everything is working correctly, youll see lines similar to:</p>
<div class="highlight"><pre><span></span><code>**<span class="w"> </span>Differences<span class="w"> </span>between<span class="w"> </span>occupations<span class="w"> </span>from<span class="w"> </span>DFT<span class="w"> </span>Green<span class="err">&#39;</span>s<span class="w"> </span><span class="k">function</span><span class="w"> </span>and
<span class="w">   </span>Fermi-Dirac<span class="w"> </span>occupations<span class="w"> </span>are<span class="w"> </span>small<span class="w"> </span>enough:
<span class="w">   </span><span class="m">0</span>.1460E-11<span class="w"> </span>is<span class="w"> </span>lower<span class="w"> </span>than<span class="w">  </span><span class="m">0</span>.1000E-03
</code></pre></div>
<p>and:</p>
<div class="highlight"><pre><span></span><code><span class="o">==</span><span class="w"> </span>Compute<span class="w"> </span>DFT<span class="w"> </span>Band<span class="w"> </span>Energy<span class="w"> </span>terms
<span class="w">     </span>Differences<span class="w"> </span>between<span class="w"> </span>band<span class="w"> </span>energy<span class="w"> </span>with<span class="w"> </span>Fermi-Dirac<span class="w"> </span>occupations
<span class="w">     </span>and<span class="w"> </span>occupations<span class="w"> </span>from<span class="w"> </span>DFT<span class="w"> </span>Green<span class="err">&#39;</span>s<span class="w"> </span><span class="k">function</span><span class="w"> </span>is:<span class="w">   </span>-0.000000
<span class="w">     </span>which<span class="w"> </span>is<span class="w"> </span>smaller<span class="w"> </span>than<span class="w">          </span><span class="m">0</span>.00001
</code></pre></div>
<p>As you can see, this integration method is highly efficient  in this example, only about <span class="arithmatex">\(500\)</span> frequencies were needed to reach excellent accuracy.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When you change the temperature, remember to increase the number of Matsubara frequencies linearly with <span class="arithmatex">\(\beta\)</span> to maintain the same effective energy range.</p>
</div>
<h3 id="510-ct-qmc-basis">5.10 CT-QMC basis<a class="headerlink" href="#510-ct-qmc-basis" title="Permanent link">&para;</a></h3>
<p>In the SCF cycle, we work in the cubic basis.
However, even though <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_solv">dmft_solv</a><span class="arithmatex">\(=7\)</span> is fully rotationally invariant and
basis independent, the choice of solver basis can in practice have a
huge impact on computation time.</p>
<p>Strong off-diagonal components in the hybridization function can make the sign problem worse. On the other hand, TRIQS/CT-HYB relies on conserved quantities (like angular momentum
or spin) to partition the local Hilbert space of size <span class="arithmatex">\(2^{2 \times (2l+1)}\)</span>, which reduces the size of the matrices that need to be handled during the simulation. These conserved
quantities are detected automatically, and their number depends strongly on the choice of basis.</p>
<p>TRIQS/CT-HYB prints the number of subspaces it finds:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>Using<span class="w"> </span>autopartition<span class="w"> </span>algorithm<span class="w"> </span>to<span class="w"> </span>partition<span class="w"> </span>the<span class="w"> </span><span class="nb">local</span><span class="w"> </span>Hilbert<span class="w"> </span>space
<span class="w">  </span>Found<span class="w"> </span><span class="m">1024</span><span class="w"> </span>subspaces.
</code></pre></div>
<p>A higher number of subspaces (thus with smaller dimensions) means smaller matrices, which reduces computation time. In this example, the local Hilbert space size is <span class="arithmatex">\(2^{10}=1024\)</span>
(<span class="arithmatex">\(l=2\)</span>), and we see <span class="arithmatex">\(1024\)</span> subspaces, each of dimension <span class="arithmatex">\(1\)</span>. Thus, we only handle scalars, and do not even need a matrix solver, as we make the density-density approximation in this
example. You can check as an exercise that the matrix sizes will increase by setting <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_solv">dmft_solv</a><span class="arithmatex">\(=7\)</span>, depending again on your basis choice.</p>
<p>So, there is a trade-off: you want to reduce off-diagonal components and maximize the number of subspaces, which isn&rsquo;t always easy. Fortunately, our interface provides many basis
options that can be set via <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_basis">dmft_triqs_basis</a> - check the glossary for all available choices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even though our interface handles the full off-diagonal hybridization and Green&rsquo;s function, some features are not available in this case. For instance, density matrix sampling (<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_measure_density_matrix">dmft_triqs_measure_density_matrix</a>) cannot be performed, making the sampling of static observables (like energy or electron number) much noisier. We wish to emphasize that this limitation comes from TRIQS/CT-HYB itself, not our interface.</p>
</div>
<p>To simplify things, you can set the off-diagonal components to zero in the CT-QMC basis via <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_off_diag">dmft_triqs_off_diag</a><span class="arithmatex">\(=0\)</span>. Be careful, as the calculation is no longer numerically exact in this case.</p>
<p>In this example, we choose to stay in the cubic basis (<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_basis">dmft_triqs_basis</a><span class="arithmatex">\(=0\)</span>) and neglect the off-diagonal components, since they vanish by symmetry anyway. The code then
automatically detects and prints the most compact block structure of the hybridization function and electronic levels:</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="o">==</span><span class="w"> </span>Searching<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>most<span class="w"> </span>optimal<span class="w"> </span>block<span class="w"> </span>structure<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>electronic<span class="w"> </span>levels<span class="w"> </span>and<span class="w"> </span>the<span class="w"> </span><span class="nv">hybridization</span>

<span class="w">   </span><span class="o">==</span><span class="w"> </span>Solving<span class="w"> </span>impurity<span class="w"> </span>model<span class="w"> </span><span class="k">for</span><span class="w"> </span>atom<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>where<span class="w"> </span>there<span class="w"> </span>are<span class="w"> </span><span class="m">10</span><span class="w"> </span>blocks

<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">0</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="m">0</span>
<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">1</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="m">1</span>
<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">2</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="m">2</span>
<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">3</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="m">3</span>
<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">4</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="m">4</span>
<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">5</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="m">5</span>
<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">6</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="m">6</span>
<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">7</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="m">7</span>
<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">8</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="m">8</span>
<span class="w">  </span>--&gt;<span class="w"> </span>Block<span class="w"> </span><span class="m">9</span><span class="w"> </span>contains<span class="w"> </span>flavor<span class="w"> </span><span class="nv">9</span>

<span class="w">   </span><span class="o">==</span><span class="w"> </span>Schematic<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>block<span class="w"> </span>structure

<span class="w">      </span><span class="m">0</span><span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.
<span class="w">      </span>.<span class="w">  </span><span class="m">1</span><span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.
<span class="w">      </span>.<span class="w">  </span>.<span class="w">  </span><span class="m">2</span><span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.
<span class="w">      </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span><span class="m">3</span><span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.
<span class="w">      </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span><span class="m">4</span><span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.
<span class="w">      </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span><span class="m">5</span><span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.
<span class="w">      </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span><span class="m">6</span><span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.
<span class="w">      </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span><span class="m">7</span><span class="w">  </span>.<span class="w">  </span>.
<span class="w">      </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span><span class="m">8</span><span class="w">  </span>.
<span class="w">      </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span>.<span class="w">  </span><span class="m">9</span>
</code></pre></div>
<p>This allows TRIQS/CT-HYB to discard some irrelevant moves, and to optimize the computation of the determinant of the hybridization matrix. In our case, there are
<span class="arithmatex">\(10\)</span> blocks of size <span class="arithmatex">\(1\)</span>, as there are no off-diagonal components. The block detection algorithm can be tuned via <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_tol_block">dmft_triqs_tol_block</a>.</p>
<h3 id="511-ct-hyb-parameters">5.11 CT-HYB parameters<a class="headerlink" href="#511-ct-hyb-parameters" title="Permanent link">&para;</a></h3>
<p>The key controls for the TRIQS/CT-HYB solver are <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_cycles">dmft_triqs_n_cycles</a>, <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_length_cycle">dmft_triqs_length_cycle</a>,
<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_warmup_cycles_init">dmft_triqs_n_warmup_cycles_init</a> and <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_warmup_cycles_restart">dmft_triqs_n_warmup_cycles_restart</a>. These parameters are
crucial for both performance and accuracy and should be carefully converged.</p>
<p>Every CT-QMC simulation begins with a warmup phase, where the Markov chain hasn&rsquo;t reached equilibrium
yet, so no measurements are taken. Each warmup phase consists of a number of cycles, and each cycle
contains <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_length_cycle">dmft_triqs_length_cycle</a> sweeps.</p>
<p>There are two kinds of warmup:</p>
<ol>
<li>The initial warmup, triggered at the first DMFT iteration, when we start from scratch (i.e. an empty
     configuration) and no initial configuration is provided by the user via <a class="wikilink codevar-wikilink" href="/variables/dmft#getctqmcdata">getctqmcdata</a>. It is
     controlled by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_warmup_cycles_init">dmft_triqs_n_warmup_cycles_init</a>, can be quite long, and must be carefully
     converged.</li>
<li>The restart warmup, used from the second DMFT iteration onward, and at the first iteration if
     a configuration file is provided via <a class="wikilink codevar-wikilink" href="/variables/dmft#getctqmcdata">getctqmcdata</a>. We automatically restart from the last saved
     CT-QMC configuration (<code>tdmft_triqs_2o_DS2_CTQMC_DATA_iatom0001.h5</code>), and thus the warmup can be
     much shorter, driven by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_warmup_cycles_restart">dmft_triqs_n_warmup_cycles_restart</a> - which can often be set to <span class="arithmatex">\(0\)</span>.</li>
</ol>
<p>The restart behavior can be disabled by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_read_ctqmcdata">dmft_triqs_read_ctqmcdata</a> as it can cause some issues in
some rare occasions - at very low temperature for instance, when the configuration weights become
extremely low.</p>
<p>After warmup, the solver moves into the measurement phase, which lasts <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_cycles">dmft_triqs_n_cycles</a> cycles.
During this phase, observables are measured at the end of each cycle.</p>
<p>One key aspect to keep in mind is that only decorrelated/independent measurements matter for statistics.
That is why <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_length_cycle">dmft_triqs_length_cycle</a> should in theory be set to match the autocorrelation time.</p>
<p>If it is too small, you are measuring correlated samples - wasting time on measurement - and if it is
too big, you are discarding valid statistics - getting fewer meaningful samples.</p>
<p>In practice, to set this value, we advise you to keep increasing it until the time spent in measurement printed here:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>Total<span class="w"> </span>measure<span class="w"> </span><span class="nb">time</span><span class="w">                         </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.0910871
</code></pre></div>
<p>is negligible compared to the simulation time. Then, check that you haven&rsquo;t lost statistics on your quantity of interest.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>We do not advise to check the autocorrelation time printed by TRIQS/CT-HYB (unlike what is said in their tutorial), as an automatic measurement of this quantity is highly unreliable.</p>
</div>
<p>At the end of a CT-HYB simulation, you will see a summary of the different Monte-Carlo moves and their
acceptance rates:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>Move<span class="w"> </span><span class="nb">set</span><span class="w"> </span>Insert<span class="w"> </span>two<span class="w"> </span>operators:<span class="w"> </span><span class="m">0</span>.401734
<span class="w">  </span>Move<span class="w"> </span><span class="nb">set</span><span class="w"> </span>Remove<span class="w"> </span>two<span class="w"> </span>operators:<span class="w"> </span><span class="m">0</span>.404321
<span class="w">  </span>Move<span class="w">  </span>Shift<span class="w"> </span>one<span class="w"> </span>operator:<span class="w"> </span><span class="m">0</span>.518682
</code></pre></div>
<p>These numbers give important clues about the sampling efficiency. If a move has a very low acceptance
rate and is not essential for ergodicity, you can disable it, but be sure of what you are doing.</p>
<p>You will find detailed explanations of the moves on the TRIQS/CT-HYB
<a href="https://triqs.github.io/cthyb/latest/basicnotions/moves.html" target="_blank">website</a>.</p>
<p>The key parameters to control the proposal distribution are <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_move_double">dmft_triqs_move_double</a>, <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_move_shift">dmft_triqs_move_shift</a> and <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_pauli_prob">dmft_triqs_pauli_prob</a>.</p>
<h3 id="512-local-hilbert-space">5.12 Local Hilbert space<a class="headerlink" href="#512-local-hilbert-space" title="Permanent link">&para;</a></h3>
<p>In principle, the local impurity problem lives in a Hilbert space of size <span class="arithmatex">\(2^{2(2l+1)}\)</span>,
which can get massive - especially for systems with <span class="arithmatex">\(f\)</span> orbitals. In practice, you
sometimes do not need to explore the entire space, because many Fock states appear so
rarely in the Monte Carlo that their contribution does not matter.</p>
<p>To help you judge this, the code prints the probability of each Fock state into the file:
<code>tdmft_triqs_2o_DS2_CTQMC_HISTOGRAM_iatom0001.dat</code>. This file is produced only when the
reduced density matrix is being sampled.</p>
<p>Each line in the file corresponds to one Fock state and has three columns, for example:</p>
<div class="codehilite"><pre><span></span><code>        2       1001000000      4.40261615217009198e-06
</code></pre></div>

<p>Here&rsquo;s what the columns mean:</p>
<ol>
<li>Total number of electrons in the configuration</li>
<li>Binary representation of the Fock state, with one bit per orbital: <span class="arithmatex">\(0\)</span> = empty, and <span class="arithmatex">\(1\)</span> = occupied. Orbitals are listed in increasing <span class="arithmatex">\(m\)</span>, first all spin-up, then all spin-down.</li>
<li>Weight of the Fock state.</li>
</ol>
<p>If you find that many configurations have essentially zero probability, you can truncate the Hilbert space by restricting the allowed number of electrons to the interval
[ <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_loc_n_min">dmft_triqs_loc_n_min</a>,<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_loc_n_max">dmft_triqs_loc_n_max</a> ]. This can noticeably speed up the
simulation.</p>
<p>However, be very careful: once you start cutting away configurations, ergodicity is no
longer guaranteed, and these parameters must be checked and converged carefully.</p>
<p>By default, the code keeps the full Hilbert space.</p>
<h3 id="513-imaginary-time">5.13 Imaginary time<a class="headerlink" href="#513-imaginary-time" title="Permanent link">&para;</a></h3>
<p>In the CT-HYB solver, both the hybridization function <span class="arithmatex">\(\Delta(\tau)\)</span> and the Green&rsquo;s
function <span class="arithmatex">\(G(\tau)\)</span> live in imaginary time, with <span class="arithmatex">\(\tau \in [0,\beta]\)</span>.</p>
<p>Even though the solver itself works in continuous time, the computer still needs a discrete
grid to store and manipulate these objects. So in practice, both <span class="arithmatex">\(\Delta(\tau)\)</span> and
<span class="arithmatex">\(G(\tau)\)</span> are represented on a uniform mesh:
\begin{equation*}
\tau_i = i \Delta \tau, i = 0,\text{n}_{\tau}-1
\end{equation*}
with <span class="arithmatex">\(\Delta \tau = \beta / (\text{n}_{\tau}-1)\)</span>.</p>
<p>Inside the solver, the hybridization function is interpolated whenever a value is needed
at an arbitrary time. For the Green&rsquo;s function, the values are averaged over their
time bin in order to produce more samples, and the value stored at each <span class="arithmatex">\(\tau_i\)</span> is therefore
a bin average, namely:
\begin{equation*}
G(\tau_i) = \frac{1}{\Delta \tau} \int_{\tau_i-\Delta \tau / 2}^{\tau_i+\Delta \tau / 2}  G(\tau) d \tau
\end{equation*}</p>
<p>This means that <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_tau">dmft_triqs_n_tau</a><span class="arithmatex">\(=\text{n}_{\tau}\)</span> is a key convergence parameter: it governs both the
interpolation error of <span class="arithmatex">\(\Delta(\tau)\)</span> and the binning error in <span class="arithmatex">\(G(\tau)\)</span>.
However, pushing the grid too fine is not automatically better - if the bins become too
small, each bin receives fewer Monte Carlo samples, which increases statistical noise.</p>
<p>A practical rule of thumb is to keep the ratio <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_cycles">dmft_triqs_n_cycles</a> / <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_tau">dmft_triqs_n_tau</a> large enough so each time bin is sufficiently populated.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When you change the temperature, remember that you should increase <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_tau">dmft_triqs_n_tau</a> proportionally to <span class="arithmatex">\(\beta\)</span> in order to keep the bin width <span class="arithmatex">\(\Delta \tau\)</span> roughly constant.</p>
</div>
<h3 id="514-compact-representation-of-the-greens-function">5.14 Compact representation of the Green&rsquo;s function<a class="headerlink" href="#514-compact-representation-of-the-greens-function" title="Permanent link">&para;</a></h3>
<p>Working directly with <span class="arithmatex">\(G(\tau)\)</span> on an imaginary-time grid has some drawbacks. Since <span class="arithmatex">\(\tau\)</span>
is discretized, the representation is not continuous, and the Fourier transform to
Matsubara frequency can suffer from aliasing errors. To avoid this, we can store the
Green&rsquo;s function in a compact basis, using only a small number of basis functions <span class="arithmatex">\(f_l(\tau)\)</span> whose Fourier
transform is known analytically:
\begin{equation*}
G(\tau) = \sum_l G_l f_l(\tau)
\end{equation*}
with <span class="arithmatex">\(G_l\)</span> the expansion coefficients.</p>
<p>We provide two compact bases. First, we have the Legendre representation
<a class="wikilink citation-wikilink" data-tippy-content="Orthogonal polynomial representation of imaginary-time Green&#x27;s functions" data-toggle="popover" href="/theory/bibliography#boehnke2011">[Boehnke2011]</a>, where:
\begin{equation*}
f_l(\tau) = P_l(2 \tau / \beta - 1)
\end{equation*}
with <span class="arithmatex">\(P_l\)</span> the Legendre polynomial of order <span class="arithmatex">\(l\)</span>.</p>
<p>If you enable this representation by setting <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_measure_g_l">dmft_triqs_measure_g_l</a><span class="arithmatex">\(=1\)</span>, the
Legendre coefficients are directly sampled in the Monte Carlo. In this case, the only
parameter you need to converge is the number of coefficients <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_n_l">dmft_triqs_n_l</a>.</p>
<p>However, we recommend the more modern and much more efficient Discrete Lehmann representation (DLR) <a class="wikilink citation-wikilink" data-tippy-content="Discrete Lehmann representation of imaginary time Green&#x27;s functions" data-toggle="popover" href="/theory/bibliography#kaye2022">[Kaye2022]</a>, with basis functions:
\begin{equation*}
f_l(\tau) = - \frac{e^{- \omega_l \tau}}{1 + e^{- \omega_l \beta}}
\end{equation*}
where <span class="arithmatex">\(\omega_l\)</span> are specially chosen DLR frequencies.</p>
<p>A key advantage of DLR is that any physical Green&rsquo;s function can be approximated within
a target accuracy <span class="arithmatex">\(\varepsilon\)</span>:
\begin{equation*}
\int_0^{\beta} \lVert G(\tau) - G_{\text{DLR}}(\tau) \rVert d \tau \le \varepsilon
\end{equation*}</p>
<p>This representation is based on the Lehmann representation:
\begin{equation*}
G(\tau) = \int_{- \omega_{\text{max}}}^{\omega_{\text{max}}} K(\tau,\omega) A(\omega) d \omega
\end{equation*}
with
\begin{equation*}
K(\tau,\omega) = - \frac{e^{- \omega \tau}}{1 + e^{- \omega \beta}}
\end{equation*}
and <span class="arithmatex">\(A(\omega)\)</span> the spectral function having support in <span class="arithmatex">\([-\omega_{\text{max}}, \omega_{\text{max}}]\)</span>.</p>
<p>The two parameters that are needed for the DLR are <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_dlr_wmax">dmft_triqs_dlr_wmax</a> and
<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_dlr_epsilon">dmft_triqs_dlr_epsilon</a>, which correspond to <span class="arithmatex">\(\omega_{\text{max}}\)</span> and <span class="arithmatex">\(\varepsilon\)</span> respectively.
Once these are specified, the DLR frequencies <span class="arithmatex">\(\omega_l\)</span> are generated, since they only depend on these two parameters. They are printed in the <code>log2</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="o">==</span><span class="w"> </span>There<span class="w"> </span>are<span class="w"> </span><span class="m">9</span><span class="w"> </span>DLR<span class="w"> </span>frequencies
<span class="w">   </span>-0.110E+01<span class="w">  </span>-0.220E+00<span class="w">  </span>-0.881E-01<span class="w">  </span>-0.362E-01<span class="w">   </span><span class="m">0</span>.184E-04<span class="w">   </span><span class="m">0</span>.528E-01<span class="w">   </span><span class="m">0</span>.122E+00<span class="w">   </span><span class="m">0</span>.299E+00<span class="w">   </span><span class="m">0</span>.110E+01
</code></pre></div>
<p>The DLR coefficients <span class="arithmatex">\(G_l\)</span> are finally obtained from a constrained fit of the noisy imaginary time data.</p>
<p>The parameter <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_dlr_wmax">dmft_triqs_dlr_wmax</a> should be converged. A sensible first estimate often
comes from the width of the DFT DOS or the correlated energy window. For example, since
bands <span class="arithmatex">\(5-13\)</span> span <span class="arithmatex">\(\sim 20-30\)</span> eV, setting <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_dlr_wmax">dmft_triqs_dlr_wmax</a><span class="arithmatex">\(=30\)</span> eV is a
reasonable start.</p>
<p>The parameter <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_dlr_epsilon">dmft_triqs_dlr_epsilon</a> should be set to the Monte-Carlo noise level,
since we do not want the fit to reproduce the statistical noise. Thus, the DLR effectively
acts as a noise filter, and we set the high-frequency contributions by constraining the
moments to be equal to their more accurate values computed from the sampled density matrix
during the fit.</p>
<p>The <span class="arithmatex">\(G(\tau)\)</span> obtained from the DLR representation is printed in the file <code>tdmft_triqs_2o_DS2_Gtau_diag_DLR_iatom0001.dat</code>, while the noisy binned data sampled directly from CT-HYB
is printed in the file <code>tdmft_triqs_2o_DS2_Gtau_diag_iatom0001.dat</code>.
You should always check that the DLR curve overlaps well with the binned data, and that
the result looks physical (smooth, correct symmetry, etc.).</p>
<p>You should obtain this for the first diagonal component:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/dlr.png" /></p>
<p>As you can see, the DLR smooths out the noise extremely well while accurately following the
more accurate low-frequency data, meaning that our DLR parameters have been well chosen.</p>
<h3 id="515-self-energy">5.15 Self-energy<a class="headerlink" href="#515-self-energy" title="Permanent link">&para;</a></h3>
<p>At the end of each DMFT iteration, the compact Green&rsquo;s function is first Fourier
transformed to Matsubara frequencies. From there, the self-energy is computed using the
Dyson equation.
Once this new self-energy is obtained, it is linearly mixed with the previous value using
the mixing parameter <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_mxsf">dmft_mxsf</a>.</p>
<p>The result is then written to <code>tdmft_triqs_2o_DS2_Self-omega_iatom0001_isppol1</code>. You should always take a quick look at the self-energy plot and verify that it looks physical. In
particular, the imaginary part should be negative:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/self_energy.png" /></p>
<p>After mixing, the new self-energy is fed back into the loop to build a new lattice Green&rsquo;s
function, and thus a new impurity problem for the next iteration.</p>
<p>At the very first iteration, the self-energy is assumed to be equal to its double counting
value, but you can also restart from a previous output using <a class="wikilink codevar-wikilink" href="/variables/dmft#getself">getself</a>. For a full
restart, make sure you also load the density with <a class="wikilink codevar-wikilink" href="/variables/files#getden">getden</a> since it is needed to
reconstruct the DFT Hamiltonian and the electronic levels.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you are doing a magnetic run but using a non-magnetic XC potential, both spin channels of the self-energy will initially be identical. To encourage the solver to enter a magnetic configuration and speed up convergence, you can manually apply a small splitting between the spin components of the self-energy using <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_shiftself">dmft_shiftself</a>.</p>
</div>
<p>By default, only the self-energy of the last iteration is written on file, but you can print each iteration with <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_prtself">dmft_prtself</a>.</p>
<h3 id="516-energy-and-number-of-electrons">5.16 Energy and Number of Electrons<a class="headerlink" href="#516-energy-and-number-of-electrons" title="Permanent link">&para;</a></h3>
<p>It is always a good idea to keep an eye on both the total energy and the number of
correlated electrons throughout the DFT+DMFT cycle. These are excellent indicators of
whether the SCF loop has actually converged, and how much noise is present in your
Monte-Carlo sampling.</p>
<p>The detailed energy decomposition is printed every iteration under:</p>
<div class="codehilite"><pre><span></span><code><span class="gd">--- !EnergyTerms</span>
</code></pre></div>

<p>and the double counting decomposition appears under:</p>
<div class="codehilite"><pre><span></span><code><span class="gd">--- !EnergyTermsDC</span>
</code></pre></div>

<p>We strongly recommend looking at the second one, as it is noticeably less noisy than
the direct energy breakdown. Just below, you will also find the total energy for the
current iteration (printed <a class="wikilink codevar-wikilink" href="/variables/basic#nstep">nstep</a> times), like:</p>
<div class="codehilite"><pre><span></span><code> ETOT 20  -124.65691761204     1.121E-03 7.030E-17 1.633E-03
</code></pre></div>

<p>If you were doing a magnetic calculation, the lattice magnetization would also be displayed after the three residuals.</p>
<p>Compared to the standard DFT energy decomposition, you will now see two additional terms:</p>
<div class="highlight"><pre><span></span><code>interaction<span class="w">         </span>:<span class="w">  </span><span class="m">2</span>.84951976985619E+00
<span class="s1">&#39;-double_counting&#39;</span><span class="w">  </span>:<span class="w"> </span>-3.03841697979330E+00
</code></pre></div>
<p>These correspond to:</p>
<ul>
<li><span class="arithmatex">\(E_U\)</span>: the Hubbard interaction energy</li>
<li><span class="arithmatex">\(E_{\text{DC}}\)</span>: the double-counting correction</li>
</ul>
<p>giving the full DFT+DMFT energy:
\begin{equation*}
E_{\text{DFT+DMFT}} = E_{\text{DFT}} + E_U - E_{\text{DC}}
\end{equation*}</p>
<p>The last two contributions are directly computed from the density matrix when the latter is sampled. Otherwise, the interaction
energy is computed from the less accurate Migdal formula.</p>
<p>As far as occupancies are concerned, the most reliable values are usually those directly
computed from the density matrix sampled in the solver, since they are less noisy. They are printed right
after the simulation for each correlated atom, first in the CT-QMC basis:</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="o">==</span><span class="w"> </span>Print<span class="w"> </span>Occupation<span class="w"> </span>matrix<span class="w"> </span><span class="k">in</span><span class="w"> </span>CTQMC<span class="w"> </span>basis

<span class="w">   </span>-------&gt;<span class="w"> </span>For<span class="w"> </span>Correlated<span class="w"> </span>Atom<span class="w"> </span><span class="m">1</span>

<span class="w">          </span>--<span class="w"> </span>polarization<span class="w"> </span>spin<span class="w"> </span>component<span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="m">0</span>.64315<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.61392<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.57103<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.61683<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.54834
</code></pre></div>
<p>and then in the cubic basis:</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span>Symmetrized<span class="w"> </span>CTQMC<span class="w"> </span>occupations

<span class="w">   </span>-------&gt;<span class="w"> </span>For<span class="w"> </span>Correlated<span class="w"> </span>Atom<span class="w"> </span><span class="m">1</span>

<span class="w">          </span>--<span class="w"> </span>polarization<span class="w"> </span>spin<span class="w"> </span>component<span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="m">0</span>.62463<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.62463<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.55968<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.62463<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000
<span class="w">        </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.00000<span class="w">   </span><span class="m">0</span>.00000<span class="w">     </span><span class="m">0</span>.55968<span class="w">   </span><span class="m">0</span>.00000
</code></pre></div>
<p>Since we used <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_basis">dmft_triqs_basis</a><span class="arithmatex">\(=0\)</span> in this example, both representations are identical.
For a magnetic calculation, this is also where you would inspect the correlated
magnetization <span class="arithmatex">\(n_{\uparrow} - n_{\downarrow}\)</span>.</p>
<p>Because both the energy and occupations contain statistical noise, it is often helpful to
run many SCF iterations just to understand the size of your error bars. Plotting these
quantities over iterations usually makes the trend easier to interpret:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/energy_nbelec.png" /></p>
<p>Rather than keeping only the last iteration <span class="arithmatex">\(N\)</span>, a better idea is to average over the last
<span class="arithmatex">\(k\)</span> iterations in order to reduce the noise, choosing <span class="arithmatex">\(k\)</span> to minimize the variance:
\begin{equation*}
\text{Var}[\frac{1}{k} \sum_{i=N-k+1}^N X_i] = \frac{1}{k} \text{Var}[X_i], i=N-k+1,N
\end{equation*}</p>
<p>In this example, we did not run enough iterations to reliably perform such an average.</p>
<h2 id="6-analytical-continuation-spectral-functions-and-restarting-a-calculation">6. Analytical Continuation, Spectral Functions, and Restarting a Calculation<a class="headerlink" href="#6-analytical-continuation-spectral-functions-and-restarting-a-calculation" title="Permanent link">&para;</a></h2>
<p>In this section, we will walk you through how to obtain both the local and <span class="arithmatex">\(k\)</span>-resolved
spectral functions by performing an analytical continuation of your imaginary-axis
Green&rsquo;s function. We will also explain how to restart a DFT+DMFT calculation.</p>
<p>The spectral function <span class="arithmatex">\(A(\omega)\)</span> is linked to the Green&rsquo;s function through the Lehmann
representation and, for the retarded Green&rsquo;s function, also satisfies:
\begin{equation*}
A(\omega) = - \frac{1}{\pi} \text{Im}[G(\omega)]
\end{equation*}</p>
<p>However, since our CT-HYB solver gives access only to the imaginary-frequency or
imaginary-time Green&rsquo;s function, we cannot apply this formula directly. An analytical
continuation is therefore required.</p>
<h3 id="61-local-spectral-function">6.1 Local spectral function<a class="headerlink" href="#61-local-spectral-function" title="Permanent link">&para;</a></h3>
<p>Let&rsquo;s start with the local spectral function, which comes from the local Green&rsquo;s function
and reflects only the spectral weight of the correlated orbitals.</p>
<p>To compute it, you simply need to analytically continue the local Green&rsquo;s function. You
should use the DLR-fitted Green&rsquo;s function rather than the raw binned data. We do not
provide an internal continuation routine, so you are free to use whatever method or library
you prefer.</p>
<p>Below, we will use TRIQS/SOM, freely available
<a href="https://github.com/krivenko/som" target="_blank">here</a>.</p>
<p>You can run our example continuation script with:</p>
<div class="codehilite"><pre><span></span><code>mpirun -n 4 python3 ../dmft_triqs_scripts/som_script_gtau.py
</code></pre></div>

<p>For the purpose of this tutorial, we intentionally relaxed the convergence parameters to
keep the runtime reasonable - the resulting spectral function is therefore not physically
meaningful. In a production calculation, you should increase the number of updates and
the number of accumulated solutions, following their tutorial.</p>
<p>We also did not exploit symmetries in the script, but for a paramagnetic system, you only
need to continue one spin channel, and with cubic symmetry, only two continuations are
required: one for the <span class="arithmatex">\(\text{t}_{2\text{g}}\)</span> orbitals and one for the <span class="arithmatex">\(\text{e}_{\text{g}}\)</span>
orbitals.</p>
<p>Since the stochastic optimization method used by TRIQS/SOM is trivially parallelizable,
feel free to throw as many CPUs as you can.</p>
<p>At the end of the continuation, you should always check that the Green&rsquo;s function
reconstructed from the resulting spectral function (using the Lehmann representation)
matches the original imaginary-time Green&rsquo;s function:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/gtau_rec.png" /></p>
<p>In our example, better convergence parameters would be necessary to obtain a closer match.</p>
<p>Once the continuation is complete, the computed spectral function is written to
<code>spectral.dat</code> by our script, and should look like this::</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/spectral_gtau.png" /></p>
<h3 id="62-k-resolved-spectral-function-and-restarting-a-calculation">6.2 <span class="arithmatex">\(k\)</span>-resolved Spectral Function and Restarting a Calculation<a class="headerlink" href="#62-k-resolved-spectral-function-and-restarting-a-calculation" title="Permanent link">&para;</a></h3>
<p>To compute the lattice spectral function in the Kohn-Sham basis - i.e., including the
spectral weight from all electrons - the workflow becomes more involved and requires an
additional ABINIT calculation. Crucially, this time you must perform the analytical
continuation on the self-energy rather than on the Green&rsquo;s function.</p>
<p>To enable this, additional output files are needed. These are produced by setting the
variable <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_prt_maxent">dmft_prt_maxent</a> to <span class="arithmatex">\(1\)</span>. Fortunately, we support restarting DFT+DMFT
calculations so that you do not need to reconverge the full cycle. For a full restart, you
should provide:</p>
<ul>
<li>the DFT+DMFT charge density</li>
<li>the DMFT self-energy</li>
<li>the CT-HYB Monte Carlo configuration (optional), to speed up the initial warmup phase</li>
</ul>
<p>These are read using the variables <a class="wikilink codevar-wikilink" href="/variables/files#getden">getden</a>, <a class="wikilink codevar-wikilink" href="/variables/dmft#getself">getself</a>, and <a class="wikilink codevar-wikilink" href="/variables/dmft#getctqmcdata">getctqmcdata</a> respectively. You can
also chain datasets in this way.</p>
<p>After copying the output files from the previous run, start the next input file which performs
a single iteration - its purpose is only to produce the analytical continuation files:</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>tdmft_triqs_2o_DS2_DEN<span class="w"> </span>tdmft_triqs_3o_DS2_DEN
cp<span class="w"> </span>tdmft_triqs_2o_DS2_Self-omega_iatom0001_isppol1<span class="w"> </span>tdmft_triqs_3o_DS2_Self-omega_iatom0001_isppol1
cp<span class="w"> </span>tdmft_triqs_2o_DS2_CTQMC_DATA_iatom0001.h5<span class="w"> </span>tdmft_triqs_3o_DS2_CTQMC_DATA_iatom0001.h5
cp<span class="w"> </span>../tdmft_triqs_3.abi<span class="w"> </span>.
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>abinit<span class="w"> </span>tdmft_triqs_3.abi<span class="w"> </span>&gt;<span class="w"> </span>log3
</code></pre></div>
<div class="text-center"><button id="uuid-2e9ac9cf-5d52-4c8b-968c-5edc58c5622f" class="md-button md-button--secondary"> View tests/tutoparal/Input/tdmft_triqs_3.abi </button></div>
<div id="uuid-d7cf6739-8c07-4725-b62a-ef245db33033" class="my_dialog" title="tests/tutoparal/Input/tdmft_triqs_3.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Multi_dataset parameters</span>
<span class="w"> </span>ndtset<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>jdtset<span class="w"> </span><span class="m">2</span>
<span class="w"> </span>getden<span class="w"> </span><span class="m">2</span>
<span class="w"> </span>getself<span class="w"> </span><span class="m">2</span>
<span class="w"> </span>getctqmcdata<span class="w"> </span><span class="m">2</span>

<span class="w"> </span>pawprtvol<span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="c1"># Printing additional information</span>
<span class="w"> </span>prtvol<span class="w"> </span><span class="m">4</span>

<span class="c1">############################</span>
<span class="c1"># Structural Parameters</span>
<span class="c1">############################</span>
<span class="c1">#Definition of unit cell</span>
<span class="w"> </span>acell<span class="w"> </span><span class="m">3</span>*5.44761<span class="w">       </span><span class="c1"># lattice parameter from J Phys. Condens. Matt</span>
<span class="w"> </span>rprim<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="c1"># Primitive cell</span>
<span class="w">        </span><span class="m">0</span>.5<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5
<span class="w">        </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w"> </span>-0.5

<span class="c1">#Definition atom</span>
<span class="w"> </span>ntypat<span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="c1"># number of different types of atoms</span>
<span class="w"> </span>znucl<span class="w"> </span><span class="m">26</span><span class="w">   </span><span class="c1"># z number of atom</span>

<span class="c1">#Definition of the atoms</span>
<span class="w"> </span>natom<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># number of atoms</span>
<span class="w"> </span>typat<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># type of atom</span>
<span class="w"> </span>xred<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w">  </span><span class="c1"># reduced coordinates for primitive cell</span>

<span class="c1">#Definition pseudopotentials</span>
<span class="w"> </span>pp_dirpath<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span><span class="w">            </span><span class="c1"># repository with pseudopotentials</span>
<span class="w"> </span>pseudos<span class="w"> </span><span class="s2">&quot;26fe.lda2.paw&quot;</span>

<span class="c1">#Definition of the k-point grid</span>
<span class="w"> </span>kptopt<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>ngkpt<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w">              </span><span class="c1"># Reciprocal space vectors are built from</span>
<span class="w">                          </span><span class="c1"># the rprim parameters. This is the size of the</span>
<span class="w">                          </span><span class="c1"># reciprocal k-points.</span>
<span class="w"> </span>nshiftk<span class="w"> </span><span class="m">2</span><span class="w">                </span><span class="c1"># Convergence of the density with regular shifts.</span>
<span class="w"> </span>shiftk<span class="w"> </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25
<span class="w">       </span>-0.25<span class="w"> </span>-0.25<span class="w"> </span>-0.25
<span class="w"> </span>istwfk<span class="w"> </span>*1

<span class="c1">############################</span>
<span class="c1"># Energy Parameters</span>
<span class="c1">############################</span>

<span class="w"> </span>ecut<span class="w"> </span><span class="m">20</span><span class="w">         </span><span class="c1"># Maximal plane-wave kinetic energy cut-off, in Hartree</span>
<span class="w"> </span>pawecutdg<span class="w"> </span><span class="m">40</span><span class="w">    </span><span class="c1"># PAW: Energy Cutoff for the Double Grid</span>
<span class="w"> </span>nband<span class="w"> </span><span class="m">20</span><span class="w">        </span><span class="c1"># Number of bands</span>
<span class="w"> </span>occopt<span class="w"> </span><span class="m">3</span><span class="w">        </span><span class="c1"># Smearing type</span>
<span class="w"> </span>tsmear<span class="w"> </span><span class="m">3000</span><span class="w"> </span>K<span class="w">   </span><span class="c1"># Electronic smearing temperature</span>

<span class="c1">#Definition of the spin properties</span>
<span class="w"> </span>nsppol<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># Spin polarized</span>
<span class="w"> </span>nspden<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># Collinear magnetism</span>
<span class="w"> </span>nspinor<span class="w"> </span><span class="m">1</span><span class="w">    </span><span class="c1"># No Spin-orbit</span>

<span class="c1">############################</span>
<span class="c1"># DMFT Calculation</span>
<span class="c1">############################</span>

<span class="w"> </span>usedmft<span class="w">   </span><span class="m">1</span><span class="w">        </span><span class="c1"># DMFT calculation</span>
<span class="w"> </span>nstep2<span class="w">    </span><span class="m">1</span><span class="w">        </span><span class="c1"># Number of iterations for the DFT+DMFT convergence</span>
<span class="w"> </span>nline2<span class="w">    </span><span class="m">10</span><span class="w">       </span><span class="c1"># Number of line minimisations</span>
<span class="w"> </span>nnsclo2<span class="w">   </span><span class="m">10</span><span class="w">       </span><span class="c1"># Number of non-self consistent loops</span>
<span class="w"> </span>tolvrs2<span class="w">   </span><span class="m">1</span>.0d-12<span class="w">  </span><span class="c1"># Tolerance of the density for DFT+DMFT convergence</span>

<span class="c1">#Definition for DMFT loop</span>
<span class="w"> </span>dmftbandi<span class="w"> </span><span class="m">5</span><span class="w">             </span><span class="c1"># First KS band included in the projection for Wannier orbitals</span>
<span class="w"> </span>dmftbandf<span class="w"> </span><span class="m">13</span><span class="w">            </span><span class="c1"># Last KS band included in the projection for Wannier orbitals</span>
<span class="w"> </span>dmft_iter<span class="w"> </span><span class="m">1</span><span class="w">             </span><span class="c1"># Number of iterations of the DMFT part.</span>
<span class="w"> </span>dmft_dc<span class="w">   </span><span class="m">6</span><span class="w">             </span><span class="c1"># AMF double counting</span>
<span class="w"> </span>dmft_prtself<span class="w"> </span><span class="m">0</span><span class="w">          </span><span class="c1"># Do not print self-energy at each iteration</span>
<span class="w"> </span>dmft_prt_maxent<span class="w"> </span><span class="m">1</span><span class="w">       </span><span class="c1"># Print files for analytical continuation</span>
<span class="w"> </span>dmft_mxsf<span class="w"> </span><span class="m">1</span>.0<span class="w">           </span><span class="c1"># Mixing parameter for self-energy</span>

<span class="c1">#Definition of impurity solver</span>
<span class="w"> </span>dmft_solv<span class="w"> </span><span class="m">6</span><span class="w">                              </span><span class="c1"># TRIQS/CT-HYB solver in density-density approximation</span>
<span class="w"> </span>dmft_triqs_n_iw<span class="w"> </span><span class="m">500</span><span class="w">                      </span><span class="c1"># Number of Matsubara frequencies</span>
<span class="w"> </span>dmft_triqs_n_tau<span class="w"> </span><span class="m">200</span><span class="w">                     </span><span class="c1"># Number of imaginary time points</span>
<span class="w"> </span>dmft_triqs_n_cycles<span class="w"> </span><span class="m">250</span><span class="w">                  </span><span class="c1"># Number of measurement cycles</span>
<span class="w"> </span>dmft_triqs_n_warmup_cycles_init<span class="w">  </span><span class="m">100</span><span class="w">     </span><span class="c1"># Number of warmup cycles for initial iteration</span>
<span class="w"> </span>dmft_triqs_n_warmup_cycles_restart<span class="w"> </span><span class="m">0</span><span class="w">     </span><span class="c1"># Number of warmup cycles when restarting</span>
<span class="w"> </span>dmft_triqs_length_cycle<span class="w"> </span><span class="m">100</span><span class="w">              </span><span class="c1"># Length of a cycle</span>
<span class="w"> </span>dmft_triqs_basis<span class="w"> </span><span class="m">0</span><span class="w">                       </span><span class="c1"># Basis for CT-QMC</span>
<span class="w"> </span>dmft_triqs_off_diag<span class="w"> </span><span class="m">0</span><span class="w">                    </span><span class="c1"># Neglect off-diagonal elements</span>
<span class="w"> </span>dmft_triqs_dlr_wmax<span class="w"> </span><span class="m">30</span><span class="w"> </span>eV<span class="w">                </span><span class="c1"># Maximal frequency for DLR representation</span>
<span class="w"> </span>dmft_triqs_dlr_epsilon<span class="w"> </span><span class="m">1</span>.d-2<span class="w">             </span><span class="c1"># Accuracy of DLR representation</span>

<span class="c1">#Definition of interaction parameters</span>
<span class="w"> </span>usepawu<span class="w">     </span><span class="m">14</span><span class="w">          </span><span class="c1"># Non-magnetic XC potential</span>
<span class="w"> </span>lpawu<span class="w">       </span><span class="m">2</span><span class="w">           </span><span class="c1"># Angular momentum for the projected Hamiltonian</span>
<span class="w"> </span>upawu<span class="w">       </span><span class="m">5</span>.5<span class="w">  </span>eV<span class="w">     </span><span class="c1"># Values of U for each angular momentum</span>
<span class="w"> </span>jpawu<span class="w">       </span><span class="m">0</span>.84<span class="w"> </span>eV<span class="w">     </span><span class="c1"># Values of J</span>

<span class="c1">#Spectral function</span>
<span class="w"> </span>dmft_kspectralfunc3<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>iscf3<span class="w"> </span>-2
<span class="w"> </span>kptopt3<span class="w"> </span>-1
<span class="w"> </span>ndivsm3<span class="w"> </span><span class="m">4</span>
<span class="w"> </span>kptbounds3<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w">      </span><span class="c1"># Gamma</span>
<span class="w">             </span><span class="m">0</span>.0<span class="w"> </span><span class="m">1</span>/2<span class="w"> </span><span class="m">0</span>.0<span class="w">      </span><span class="c1"># N</span>
<span class="w"> </span>tolwfr3<span class="w"> </span><span class="m">1</span>.d-6
<span class="w"> </span>nbandkss3<span class="w"> </span><span class="m">20</span>
<span class="w"> </span>kssform3<span class="w"> </span><span class="m">3</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-d7cf6739-8c07-4725-b62a-ef245db33033", "#uuid-2e9ac9cf-5d52-4c8b-968c-5edc58c5622f") }); </script>

<p>Running this produces several additional files:</p>
<ul>
<li><code>tdmft_triqs_3o_DS2_Selfmxent0001_is1_iflavxxxx</code>: these contain the flavor-resolved self-energy on the imaginary axis, expressed in the basis that diagonalizes the impurity electronic levels. This is necessary because ABINIT&rsquo;s <span class="arithmatex">\(k\)</span>-resolved spectral function workflow does not support off-diagonal self-energy components (nor do most continuation tools anyway). Using this basis is important to minimize off-diagonal terms. In our example, they vanished in the cubic basis, but we write this tutorial for general use.</li>
<li><code>tdmft_triqs_3o_DS2_UnitaryMatrix_iatom0001</code>: the rotation matrix connecting the cubic basis to the diagonal basis.</li>
<li><code>tdmft_triqs_3o_DS2_DMFTOVERLAP_iatom0001_isppol1</code>: the Brillouin-zone overlap matrix needed later to reconstruct the spectral function.</li>
</ul>
<p>Next, you must perform the analytical continuation of the self-energy. We again provide a
Python template using TRIQS/SOM.</p>
<p>There are two possible strategies. First, you can continue an auxiliary Green&rsquo;s function,
by building an articifial Green&rsquo;s function
<span class="arithmatex">\(G(i\omega_n) = \frac{1}{i\omega_n + \mu - \Sigma(i\omega_n)}\)</span>, continue it, and then
recover the self-energy on the real axis.</p>
<p>Or you can directly continue the self-energy, which is the approach used in this example.
In this case, to satisfy the Lehmann
representation, you must subtract the zeroth moment <span class="arithmatex">\(\Sigma_{\infty}\)</span>. The spectral
function then integrates to the first moment <span class="arithmatex">\(\Sigma_1\)</span> instead of <span class="arithmatex">\(1\)</span> as for the Green&rsquo;s
function. Depending on the continuation tool, you may need to normalize
<span class="arithmatex">\(\Sigma(i\omega_n)-\Sigma_{\infty}\)</span> by <span class="arithmatex">\(\Sigma_1\)</span> if unnormalized spectral functions are
not handled, or you can directly pass the required normalization (TRIQS/SOM supports this).</p>
<p>Our implementation computes all high-frequency moments analytically in a self-consistent
fashion, and the first four moments are provided at the end of each <code>Selfmxent</code> file.
The relevant values of <span class="arithmatex">\(\Sigma_{\infty}\)</span> and <span class="arithmatex">\(\Sigma_1\)</span> (real and imaginary parts) appear
under <code>#moments_1</code> and <code>#moments_2</code>.</p>
<p>Run the continuation with:</p>
<div class="codehilite"><pre><span></span><code>mpirun -n 4 python3 ../dmft_triqs_scripts/som_script_self.py
</code></pre></div>

<p>As always, compare the reconstructed self-energy to the input one:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/self_rec.png" /></p>
<p>With sufficiently tight convergence parameters, they should overlap closely.</p>
<p>Now, you can compute the <span class="arithmatex">\(k\)</span>-resolved spectral function in ABINIT. In the input file
<code>tdmft_triqs_3.abi</code>, switch to the next dataset:</p>
<div class="codehilite"><pre><span></span><code>jdtset 3
</code></pre></div>

<p>This step resembles a band-structure calculation: it is non-self consistent, so <a class="wikilink codevar-wikilink" href="/variables/basic#iscf">iscf</a>
is set to <span class="arithmatex">\(-2\)</span>. You also need to write the <code>KSS</code> file using <a class="wikilink codevar-wikilink" href="/variables/files#kssform">kssform</a> and <a class="wikilink codevar-wikilink" href="/variables/gw#nbandkss">nbandkss</a>.
Keeping all DMFT parameters unchanged, activate the spectral function computation with
<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_kspectralfunc">dmft_kspectralfunc</a><span class="arithmatex">\(=1\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even though the impurity solver does not play a direct role here, you must still keep <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_solv">dmft_solv</a> equal to <span class="arithmatex">\(6\)</span> or <span class="arithmatex">\(7\)</span>, because ABINIT uses solver-dependent conventions, for example when treating the high-frequency moments, which are not computed analytically in ABINIT&rsquo;s internal implementation.</p>
</div>
<p>Since we compute the spectral function only along a few <span class="arithmatex">\(k\)</span>-points, we set <a class="wikilink codevar-wikilink" href="/variables/basic#kptopt">kptopt</a> to a
negative value and define the path in the Brillouin zone using <a class="wikilink codevar-wikilink" href="/variables/gstate#kptbounds">kptbounds</a> (here between
<span class="arithmatex">\(\Gamma\)</span> and <span class="arithmatex">\(N\)</span>). To obtain a spectral function integrated over the whole Brillouin zone,
use a positive <a class="wikilink codevar-wikilink" href="/variables/basic#kptopt">kptopt</a> instead.</p>
<p>This calculation requires several input files:</p>
<ul>
<li>the converged DFT+DMFT density <code>tdmft_triqs_3o_DS2_DEN</code></li>
<li>the DMFT self-energy on the imaginary axis <code>tdmft_triqs_3o_DS2_Self-omega_iatom0001_isppol1</code>, needed to recover the chemical potential, the double-counting potential and high-frequency moments</li>
</ul>
<p>These are read using <a class="wikilink codevar-wikilink" href="/variables/files#getden">getden</a> and <a class="wikilink codevar-wikilink" href="/variables/dmft#getself">getself</a> set to <span class="arithmatex">\(2\)</span>.</p>
<p>You must also supply:</p>
<ul>
<li>the real-frequency grid in <code>tdmft_triqs_3o_DS3_spectralfunction_realgrid</code> (first line: number of points; following lines: frequencies)</li>
<li>the real-axis self-energy in <code>tdmft_triqs_3i_DS3_Self_ra-omega_iatom0001_isppol1</code> (two columns: <span class="arithmatex">\(\omega\)</span> and <span class="arithmatex">\(-2 \text{Im}[\Sigma(\omega)]\)</span> (be careful of the convention). All flavors are listed sequentially, using the same frequency grid as provided above.</li>
</ul>
<p>These files were produced by the script.</p>
<p>Finally, provide the rotation matrix:</p>
<div class="codehilite"><pre><span></span><code>cp tdmft_triqs_3o_DS2_UnitaryMatrix_iatom0001 tdmft_triqs_3i_DS3_UnitaryMatrix_iatom0001
</code></pre></div>

<p>and the overlap matrix:</p>
<div class="codehilite"><pre><span></span><code>cp tdmft_triqs_3o_DS2_DMFTOVERLAP_iatom0001_isppol1 tdmft_triqs_3i_DS3_DMFTOVERLAP_iatom0001_isppol1
</code></pre></div>

<p>Then run:</p>
<div class="codehilite"><pre><span></span><code>mpirun -n 4 abinit tdmft_triqs_3.abi &gt; log3
</code></pre></div>

<p>ABINIT first reconstructs the self-energy on the imaginary axis from your analytical
continuation, writing it to <code>tdmft_triqs_3o_DS3_DFTDMFT_Self_backtransform.dat</code>. You should
verify that it agrees with the original input, though we already did that with the script.</p>
<p>Next, the real part of the self-energy on the real axis is obtained from the imaginary part via the Kramers-Kronig relation in <code>tdmft_triqs_3o_DS3_DFTDMFT_Self_realaxis.dat</code>.
ABINIT then builds the lattice Green&rsquo;s function on the real axis and computes the local
spectral function in <code>tdmft_triqs_3o_DS3_DFTDMFT_SpFunloc_iatom0001</code>.</p>
<p>In principle, this should match the local spectral function obtained in the previous
section. Here, however, the comparison is not meaningful because only a small number of
<span class="arithmatex">\(k\)</span>-points were sampled - <a class="wikilink codevar-wikilink" href="/variables/basic#kptopt">kptopt</a><span class="arithmatex">\(&gt;0\)</span> would be required.</p>
<p>Finally, the <span class="arithmatex">\(k\)</span>-resolved spectral function is written to
<code>tdmft_triqs_3o_DS3_DFTDMFT_SpectralFunction_kres</code> for each <span class="arithmatex">\(k\)</span>-point and frequency.
You can visualize it using the provided script:</p>
<div class="codehilite"><pre><span></span><code>python3 ../dmft_triqs_scripts/plot_kres.py
</code></pre></div>

<p>which should produce a plot similar to:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/kres_spectral.png" /></p>
<h2 id="7-exact-double-counting-formula-enforcing-stationarity-and-providing-a-custom-orbital">7. Exact double counting formula, enforcing stationarity, and providing a custom orbital<a class="headerlink" href="#7-exact-double-counting-formula-enforcing-stationarity-and-providing-a-custom-orbital" title="Permanent link">&para;</a></h2>
<p>In this section, we will explain how to activate the exact double counting formula and how
to enforce stationarity in your DFT+DMFT calculations - an essential requirement when
computing free energies. We also show how to supply a custom correlated orbital.</p>
<p>As discussed in section <span class="arithmatex">\(5.3\)</span>, the correlated orbital defining the DMFT
projector is obtained by projecting the orbital specified by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a>
onto a low-energy subspace <span class="arithmatex">\(\mathcal{H}\)</span>, composed of Kohn-Sham states with band indices
between <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandi">dmftbandi</a> and <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandf">dmftbandf</a>.</p>
<p>However, because Kohn-Sham wavefunctions depend on the electronic density, they evolve
during the SCF cycle. Consequently, the DMFT projector is not strictly constant across
iterations. For strongly correlated systems, where the density may vary significantly
when adding DMFT, this can potentially lead to substantial shifts of the orbital and even
to spectral weight leaking outside the correlated energy window. To ensure that the
self-consistent solution corresponds to a stationary point of a well-defined DFT+DMFT
Baym-Kadanoff functional, the DMFT correlated orbital must remain fixed throughout the
cycle.</p>
<p>This is even more critical when comparing free energies across different volumes,
temperatures, or phases: all calculations must rely on the same Baym-Kadanoff functional,
which means using the same fixed orbital, and also the same values of <span class="arithmatex">\(U\)</span> and <span class="arithmatex">\(J\)</span> - a point
often overlooked in the literature.</p>
<h3 id="71-fixing-the-dmft-orbital">7.1 Fixing the DMFT orbital<a class="headerlink" href="#71-fixing-the-dmft-orbital" title="Permanent link">&para;</a></h3>
<p>The only way to strictly fix the orbital is to converge with respect to <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandi">dmftbandi</a>
and <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandf">dmftbandf</a> until the projected orbital matches the target orbital <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a>
by virtue of the completeness of the Kohn-Sham basis.</p>
<p>This is especially important when using the exact double counting formula, which requires
access to the local orbital in real space. The implementation assumes that the projection
of <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a> onto the correlated window is equal to <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a> itself in order
to do that.</p>
<p>However, if <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a> is chosen as a truncated atomic orbital, achieving
convergence in the correlated window may be impractical, often requiring an excessively
large number of bands. A more robust approach consists in projecting the atomic orbital
onto a finite energy window for a chosen reference system (at a given temperature and
volume). This projection defines a Wannier function, less localized and easier to converge,
as high-energy components have been filtered out.</p>
<p>Once this reference Wannier function has been produced, you need to use it on all
subsequent systems for which you wish to compare energy differences. If these systems
are close to your reference system, the Kohn-Sham wavefunctions will be very similar to those
of your reference system, and the convergence with <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandi">dmftbandi</a> and <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandf">dmftbandf</a> will be extremely fast,
and you will barely need to increase the energy window compared to the one used to produce the original
Wannier function. This convergence will be even more facilitated if the original window is large enough.</p>
<p>You can compute this real-space projected orbital using <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_prtwan">dmft_prtwan</a>, which writes the
projection of <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a> onto the correlated energy window. The maximum radius is
controlled via <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_wanrad">dmft_wanrad</a>. For DMFT to remain meaningful, the orbital must not
overlap with the one from neighboring atoms; therefore the energy window must be
sufficiently large, and <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_wanrad">dmft_wanrad</a> chosen so that the Wannier function essentially
vanishes outside this radius such that you capture all the weight of the orbital.</p>
<p>Start the calculation of the Wannier function:</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>../tdmft_triqs_4.abi<span class="w"> </span>.
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>abinit<span class="w"> </span>tdmft_triqs_4.abi<span class="w"> </span>&gt;<span class="w"> </span>log4
</code></pre></div>
<div class="text-center"><button id="uuid-4ca5644c-037e-444d-8d1b-9f122475167e" class="md-button md-button--secondary"> View tests/tutoparal/Input/tdmft_triqs_4.abi </button></div>
<div id="uuid-1b92a3c6-0515-4e83-b757-830206a08c7f" class="my_dialog" title="tests/tutoparal/Input/tdmft_triqs_4.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Multi_dataset parameters</span>
<span class="w"> </span>ndtset<span class="w"> </span><span class="m">2</span><span class="w">       </span><span class="c1"># Two datasets</span>
<span class="w"> </span>jdtset<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w">     </span><span class="c1"># one followed by two</span>
<span class="w"> </span>getden<span class="w"> </span>-1<span class="w">      </span><span class="c1"># Second one takes the density of first</span>

<span class="w"> </span>pawprtvol<span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="c1"># Printing additional information</span>
<span class="w"> </span>prtvol<span class="w"> </span><span class="m">4</span>

<span class="c1">############################</span>
<span class="c1"># Structural Parameters</span>
<span class="c1">############################</span>
<span class="c1">#Definition of unit cell</span>
<span class="w"> </span>acell<span class="w"> </span><span class="m">3</span>*5.44761<span class="w">       </span><span class="c1"># lattice parameter from J Phys. Condens. Matt</span>
<span class="w"> </span>rprim<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="c1"># Primitive cell</span>
<span class="w">        </span><span class="m">0</span>.5<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5
<span class="w">        </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w"> </span>-0.5

<span class="c1">#Definition atom</span>
<span class="w"> </span>ntypat<span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="c1"># number of different types of atoms</span>
<span class="w"> </span>znucl<span class="w"> </span><span class="m">26</span><span class="w">   </span><span class="c1"># z number of atom</span>

<span class="c1">#Definition of the atoms</span>
<span class="w"> </span>natom<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># number of atoms</span>
<span class="w"> </span>typat<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># type of atom</span>
<span class="w"> </span>xred<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w">  </span><span class="c1"># reduced coordinates for primitive cell</span>

<span class="c1">#Definition pseudopotentials</span>
<span class="w"> </span>pp_dirpath<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span><span class="w">            </span><span class="c1"># repository with pseudopotentials</span>
<span class="w"> </span>pseudos<span class="w"> </span><span class="s2">&quot;26fe.lda2.paw&quot;</span>

<span class="c1">#Definition of the k-point grid</span>
<span class="w"> </span>kptopt<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>ngkpt<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w">              </span><span class="c1"># Reciprocal space vectors are built from</span>
<span class="w">                          </span><span class="c1"># the rprim parameters. This is the size of the</span>
<span class="w">                          </span><span class="c1"># reciprocal k-points.</span>
<span class="w"> </span>nshiftk<span class="w"> </span><span class="m">2</span><span class="w">                </span><span class="c1"># Convergence of the density with regular shifts.</span>
<span class="w"> </span>shiftk<span class="w"> </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25
<span class="w">       </span>-0.25<span class="w"> </span>-0.25<span class="w"> </span>-0.25
<span class="w"> </span>istwfk<span class="w"> </span>*1

<span class="c1">############################</span>
<span class="c1"># Energy Parameters</span>
<span class="c1">############################</span>

<span class="w"> </span>ecut<span class="w"> </span><span class="m">20</span><span class="w">         </span><span class="c1"># Maximal plane-wave kinetic energy cut-off, in Hartree</span>
<span class="w"> </span>pawecutdg<span class="w"> </span><span class="m">40</span><span class="w">    </span><span class="c1"># PAW: Energy Cutoff for the Double Grid</span>
<span class="w"> </span>nband<span class="w"> </span><span class="m">20</span><span class="w">        </span><span class="c1"># Number of bands</span>
<span class="w"> </span>occopt<span class="w"> </span><span class="m">3</span><span class="w">        </span><span class="c1"># Smearing type</span>
<span class="w"> </span>tsmear<span class="w"> </span><span class="m">3000</span><span class="w"> </span>K<span class="w">   </span><span class="c1"># Electronic smearing temperature</span>

<span class="c1">############################</span>
<span class="c1"># DFT Calculation</span>
<span class="c1">############################</span>

<span class="w"> </span>nstep1<span class="w"> </span><span class="m">30</span><span class="w">        </span><span class="c1"># Number of iterations for the DFT convergence</span>
<span class="w"> </span>tolvrs1<span class="w"> </span><span class="m">1</span>.0d-12<span class="w">  </span><span class="c1"># Tolerance of the density for DFT convergence</span>

<span class="c1">#Definition of the spin properties</span>
<span class="w"> </span>nsppol<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># Spin polarized</span>
<span class="w"> </span>nspden<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># Collinear magnetism</span>
<span class="w"> </span>nspinor<span class="w"> </span><span class="m">1</span><span class="w">    </span><span class="c1"># No Spin-orbit</span>

<span class="c1">############################</span>
<span class="c1"># DMFT Calculation</span>
<span class="c1">############################</span>

<span class="w"> </span>usedmft2<span class="w">  </span><span class="m">1</span><span class="w">        </span><span class="c1"># DMFT calculation</span>
<span class="w"> </span>nstep2<span class="w">    </span><span class="m">1</span><span class="w">        </span><span class="c1"># Number of iterations for the DFT+DMFT convergence</span>
<span class="w"> </span>nline2<span class="w">    </span><span class="m">10</span><span class="w">       </span><span class="c1"># Number of line minimisations</span>
<span class="w"> </span>nnsclo2<span class="w">   </span><span class="m">10</span><span class="w">       </span><span class="c1"># Number of non-self consistent loops</span>
<span class="w"> </span>tolvrs2<span class="w">   </span><span class="m">1</span>.0d-12<span class="w">  </span><span class="c1"># Tolerance of the density for DFT+DMFT convergence</span>

<span class="c1">#Definition for DMFT loop</span>
<span class="w"> </span>dmftbandi<span class="w"> </span><span class="m">5</span><span class="w">             </span><span class="c1"># First KS band included in the projection for Wannier orbitals</span>
<span class="w"> </span>dmftbandf<span class="w"> </span><span class="m">20</span><span class="w">            </span><span class="c1"># Last KS band included in the projection for Wannier orbitals</span>
<span class="w"> </span>dmft_iter<span class="w"> </span><span class="m">1</span><span class="w">             </span><span class="c1"># Number of iterations of the DMFT part.</span>
<span class="w"> </span>dmft_dc<span class="w">   </span><span class="m">8</span><span class="w">             </span><span class="c1"># Exact double counting formula</span>
<span class="w"> </span>dmft_prtself<span class="w"> </span><span class="m">0</span><span class="w">          </span><span class="c1"># Do not print self-energy at each iteration</span>
<span class="w"> </span>dmft_prt_maxent<span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="c1"># Do not print files for analytical continuation</span>
<span class="w"> </span>dmft_mxsf<span class="w"> </span><span class="m">1</span>.0<span class="w">           </span><span class="c1"># Mixing parameter for self-energy</span>
<span class="w"> </span>dmft_prtwan<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># Print Wannier functions</span>
<span class="w"> </span>dmft_wanrad<span class="w"> </span><span class="m">3</span>.0<span class="w">         </span><span class="c1"># Radius of Wannier function</span>
<span class="w"> </span>dmft_orbital<span class="w"> </span><span class="m">1</span><span class="w">          </span><span class="c1"># 1: atomic orbital, -1: orbital from file</span>
<span class="w"> </span>dmft_orbital_filepath<span class="w"> </span><span class="s2">&quot;Fe_Wannier&quot;</span>

<span class="w"> </span>dmft_yukawa_param<span class="w"> </span><span class="m">1</span>

<span class="c1">#Definition of impurity solver</span>
<span class="w"> </span>dmft_solv<span class="w"> </span><span class="m">6</span><span class="w">                              </span><span class="c1"># TRIQS/CT-HYB solver in density-density approximation</span>
<span class="w"> </span>dmft_triqs_n_iw<span class="w"> </span><span class="m">500</span><span class="w">                      </span><span class="c1"># Number of Matsubara frequencies</span>
<span class="w"> </span>dmft_triqs_n_tau<span class="w"> </span><span class="m">200</span><span class="w">                     </span><span class="c1"># Number of imaginary time points</span>
<span class="w"> </span>dmft_triqs_n_cycles<span class="w"> </span><span class="m">250</span><span class="w">                  </span><span class="c1"># Number of measurement cycles</span>
<span class="w"> </span>dmft_triqs_n_warmup_cycles_init<span class="w">  </span><span class="m">100</span><span class="w">     </span><span class="c1"># Number of warmup cycles for initial iteration</span>
<span class="w"> </span>dmft_triqs_n_warmup_cycles_restart<span class="w"> </span><span class="m">0</span><span class="w">     </span><span class="c1"># Number of warmup cycles when restarting</span>
<span class="w"> </span>dmft_triqs_length_cycle<span class="w"> </span><span class="m">100</span><span class="w">              </span><span class="c1"># Length of a cycle</span>
<span class="w"> </span>dmft_triqs_basis<span class="w"> </span><span class="m">0</span><span class="w">                       </span><span class="c1"># Basis for CT-QMC</span>
<span class="w"> </span>dmft_triqs_off_diag<span class="w"> </span><span class="m">0</span><span class="w">                    </span><span class="c1"># Neglect off-diagonal elements</span>
<span class="w"> </span>dmft_triqs_dlr_wmax<span class="w"> </span><span class="m">30</span><span class="w"> </span>eV<span class="w">                </span><span class="c1"># Maximal frequency for DLR representation</span>
<span class="w"> </span>dmft_triqs_dlr_epsilon<span class="w"> </span><span class="m">1</span>.d-2<span class="w">             </span><span class="c1"># Accuracy of DLR representation</span>

<span class="c1">#Definition of interaction parameters</span>
<span class="w"> </span>usepawu1<span class="w">    </span><span class="m">4</span>
<span class="w"> </span>usepawu2<span class="w">    </span><span class="m">14</span><span class="w">          </span><span class="c1"># Non-magnetic XC potential</span>
<span class="w"> </span>lpawu<span class="w">       </span><span class="m">2</span><span class="w">           </span><span class="c1"># Angular momentum for the projected Hamiltonian</span>
<span class="w"> </span>upawu1<span class="w">      </span><span class="m">0</span>.00<span class="w"> </span>eV
<span class="w"> </span>upawu2<span class="w">      </span><span class="m">5</span>.5<span class="w">  </span>eV<span class="w">     </span><span class="c1"># Values of U for each angular momentum</span>
<span class="w"> </span>jpawu2<span class="w">      </span><span class="m">0</span>.84<span class="w"> </span>eV<span class="w">     </span><span class="c1"># Values of J</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-1b92a3c6-0515-4e83-b757-830206a08c7f", "#uuid-4ca5644c-037e-444d-8d1b-9f122475167e") }); </script>

<p>Here, we selected a larger energy window and set <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandf">dmftbandf</a> to <span class="arithmatex">\(20\)</span> to better validate
the DMFT approximation and to obtain a more localized Wannier function. The radial part
of the Wannier orbital is written to <code>tdmft_triqs_4o_DS2_Wannier_functions_iatom0001_001</code>
for each angular momentum channel <span class="arithmatex">\(m\)</span>, using the PAW radial grid extended to
<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_wanrad">dmft_wanrad</a>.</p>
<h3 id="72-providing-a-custom-orbital">7.2 Providing a custom orbital<a class="headerlink" href="#72-providing-a-custom-orbital" title="Permanent link">&para;</a></h3>
<p>To use this projected orbital as your correlated orbital, set <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a> to <span class="arithmatex">\(-1\)</span>.</p>
<p>The base name of the file is determined by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital_filepath">dmft_orbital_filepath</a>, and the file for
each atom type must be named <code>dmft_orbital_filepath_xxxx</code> where <code>xxxx</code> is the four-digit
atom type index (left-padded with <span class="arithmatex">\(0\)</span>s).</p>
<p>Each file must contain a single column:</p>
<ul>
<li>first line: number of radial grid points</li>
<li>subsequent lines: values of the reduced radial wavefunction <span class="arithmatex">\(u_l(r)\)</span> on the PAW radial grid</li>
</ul>
<p>You must use the PAW radial grid (but may extend it beyond the PAW radius using the same
grid construction). Again, this is automatically done in the <code>Wannier</code> files if you do not
know how to do it. If you have the orbital on a different mesh, simply perform a cubic
spline interpolation onto the PAW grid.</p>
<p>For the orbital values, you may, for instance, average the Wannier functions over the <span class="arithmatex">\(m\)</span>
channels. The script below generates the <code>Fe_Wannier_0001</code> file:</p>
<div class="codehilite"><pre><span></span><code>python3 ../dmft_triqs_scripts/wannier_script.py
</code></pre></div>

<p>Then, instruct ABINIT to read the orbital from file and restart:</p>
<div class="highlight"><pre><span></span><code>dmft_orbital<span class="w"> </span>-1
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>abinit<span class="w"> </span>tdmft_triqs_4.abi<span class="w"> </span>&gt;<span class="w"> </span>log4
</code></pre></div>
<p>You can verify in the <code>log4</code> that the weight of the Wannier function is nearly <span class="arithmatex">\(1\)</span>, as it should be:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="o">=====</span><span class="w">  </span>Build<span class="w"> </span>DMFT<span class="w"> </span>radial<span class="w"> </span>orbital<span class="w"> </span><span class="k">for</span><span class="w"> </span>atom<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="nv">1</span><span class="w"> </span><span class="o">========</span>

<span class="w"> </span>Using<span class="w"> </span>wavefunction<span class="w"> </span>from<span class="w"> </span>file<span class="w"> </span>Fe_Wannier_0001
<span class="w"> </span>Squared<span class="w"> </span>norm<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>DMFT<span class="w"> </span>orbital:<span class="w"> </span><span class="m">0</span>.9972
</code></pre></div>
<p>With this setup, the file printed by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_prtwan">dmft_prtwan</a> now corresponds to the projection
of the Wannier function itself. Since we use the exact same system as for constructing the
original Wannier function, and provided <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_wanrad">dmft_wanrad</a> is large enough, the projected
Wannier function should closely match the original already at <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandf">dmftbandf</a><span class="arithmatex">\(=20\)</span> (at least
in the first iteration). You can confirm this by comparing them:</p>
<p><img alt="dmft_cycle_tuto" src="../dmft_triqs_assets/wannier.png" /></p>
<p>As seen above, the projected Wannier function almost perfectly overlaps the original one,
in contrast with the case where <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_orbital">dmft_orbital</a> was a raw atomic orbital. If you vary the
density (through additional iterations, or by changing the temperature or volume), you may
need to increase <a class="wikilink codevar-wikilink" href="/variables/dmft#dmftbandf">dmftbandf</a> in order to achieve this overlap. A sufficiently large
starting energy window simplifies the process.</p>
<h3 id="73-activating-the-exact-double-counting-formula">7.3 Activating the exact double-counting formula<a class="headerlink" href="#73-activating-the-exact-double-counting-formula" title="Permanent link">&para;</a></h3>
<p>Once the DMFT downfolding operator has been fixed, you can safely use the exact double
counting formula by setting <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_dc">dmft_dc</a> to <span class="arithmatex">\(8\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This formula is available only for non-magnetic XC potentials and for the LDA and PBE XC functionals.</p>
</div>
<p>Unlike approximate formulas, the exact double counting formula requires the screened
interaction potential V<span class="arithmatex">\(_{\text{scr}}(r)\)</span> in real space. The implementation assumes a
Yukawa potential:
\begin{equation*}
\text{V}_{\text{scr}}(r) = \frac{e^{-\lambda r}}{\varepsilon r}
\end{equation*}
where <span class="arithmatex">\(\lambda\)</span> and <span class="arithmatex">\(\varepsilon\)</span> respectively denote the inverse screening length and the
dielectric constant, and are parameters of the calculation.</p>
<p>These parameters can be set in several ways depending on <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_yukawa_param">dmft_yukawa_param</a>. If
<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_yukawa_param">dmft_yukawa_param</a><span class="arithmatex">\(=1\)</span>, the values of <span class="arithmatex">\(\lambda\)</span> and <span class="arithmatex">\(\varepsilon\)</span> are automatically
chosen so that the resulting Slater integrals match as closely as possible those defined
by <a class="wikilink codevar-wikilink" href="/variables/paw#upawu">upawu</a>, <a class="wikilink codevar-wikilink" href="/variables/paw#jpawu">jpawu</a>, <a class="wikilink codevar-wikilink" href="/variables/paw#f4of2_sla">f4of2_sla</a>, and <a class="wikilink codevar-wikilink" href="/variables/paw#f6of2_sla">f6of2_sla</a>. For <a class="wikilink codevar-wikilink" href="/variables/paw#lpawu">lpawu</a> <span class="arithmatex">\(\ge 2\)</span>, there
are Slater integrals than Yukawa parameters, so the Yukawa form cannot reproduce all Slater
integrals perfectly, but it provides the best possible fit.</p>
<p>If you prefer to set <span class="arithmatex">\(\lambda\)</span> and <span class="arithmatex">\(\varepsilon\)</span> manually, use <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_yukawa_param">dmft_yukawa_param</a><span class="arithmatex">\(=4\)</span>
together with <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_yukawa_lambda">dmft_yukawa_lambda</a> and <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_yukawa_epsilon">dmft_yukawa_epsilon</a>. See the glossary for the
full list of options. Note that the assumption of a Yukawa potential is strictly satisfied
only for <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_solv">dmft_solv</a><span class="arithmatex">\(=7\)</span>.</p>
<p>A summary of the chosen Yukawa parameters, along with the resulting <span class="arithmatex">\(U\)</span>, <span class="arithmatex">\(J\)</span>, and Slater
integrals, appears in <code>log4</code>:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>Yukawa<span class="w"> </span>parameters<span class="w"> </span><span class="k">for</span><span class="w"> </span>atom<span class="w"> </span>type:<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>Lambda:<span class="w">    </span><span class="m">1</span>.3326
<span class="w"> </span>Epsilon:<span class="w">   </span><span class="m">1</span>.5796
<span class="w"> </span>U:<span class="w">         </span><span class="m">0</span>.2021
<span class="w"> </span>J:<span class="w">         </span><span class="m">0</span>.0305

<span class="w">   </span>Slater<span class="w"> </span>parameters<span class="w"> </span>F^0,<span class="w"> </span>F^2,<span class="w"> </span>F^4<span class="w"> </span>are<span class="w">   </span><span class="m">0</span>.2021<span class="w">   </span><span class="m">0</span>.2509<span class="w">   </span><span class="m">0</span>.1757
</code></pre></div>
<h2 id="8-entropy-calculation">8. Entropy calculation<a class="headerlink" href="#8-entropy-calculation" title="Permanent link">&para;</a></h2>
<p>You now have all the ingredients required to compute the DFT+DMFT free energy. This is
significantly more demanding than evaluating just the internal energy - both in terms
of accuracy and computational cost. Formally, what we want is the full Baym-Kadanoff
functional, which in DFT+DMFT reads:
\begin{equation*}
F_{\text{DFT+DMFT}} = E_{\text{DFT}} + \text{Tr}[\log[G]] + \mu N - \text{Tr}[\Sigma G] + \text{Tr}[V_{\text{DC}} \rho] - E_{\text{band}} - \text{Tr}[\log[G_{\text{imp}}]] + \text{Tr}[\Sigma_{\text{imp}} G_{\text{imp}}]
+ F_{\text{imp}} - E_{\text{DC}}
\end{equation*}</p>
<p>Here, the impurity free energy is:
\begin{equation*}
F_{\text{imp}} = E_{\text{imp}}^{\text{kin}} + E_U - T S_{\text{imp}}
\end{equation*}
with <span class="arithmatex">\(S_{\text{imp}}\)</span> the impurity entropy.</p>
<p>You can activate the calculation of this functional using <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_entropy">dmft_triqs_entropy</a>. Most
contributions to the functional are cheap to compute - except for the impurity entropy
<span class="arithmatex">\(S_{\text{imp}}\)</span>, which typically dominates the overall entropy and the computational cost. If you only want to test convergence, you may omit <span class="arithmatex">\(S_{\text{imp}}\)</span> and compute the
remainder <span class="arithmatex">\(S_{\text{DFT+DMFT}}-S_{\text{imp}}\)</span>.</p>
<p>The computation of the impurity entropy is done using thermodynamic integration, and this
is controlled separately by <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_compute_integral">dmft_triqs_compute_integral</a>. We introduce a coupling
constant <span class="arithmatex">\(\lambda \in [0,1]\)</span>, and define a <span class="arithmatex">\(\lambda\)</span> dependent impurity Hamiltonian:</p>
<div class="arithmatex">\[\begin{equation*}
\hat{H}(\lambda) = \sum_{ij} (\varepsilon_{ij} - ( \mu + (1 - \lambda)  \times \delta \mu ) \delta_{ij}) \hat{c}_i^{\dagger} \hat{c}_j
+ \frac{1}{2} \lambda \sum_{ijkl} U_{ijkl} \hat{c}_i^{\dagger}
\hat{c}_j^{\dagger} \hat{c}_l \hat{c}_k +  \sum_{i \alpha} [ V_{i \alpha} \hat{c}_i^{\dagger} \hat{d}_{\alpha}
+ V_{i \alpha}^{*}  \hat{d}_{\alpha}^{\dagger} \hat{c}_i  ]
\end{equation*}\]</div>
<p>The operators <span class="arithmatex">\(\hat{c}_i\)</span> and <span class="arithmatex">\(\hat{d}_{\alpha}\)</span> act on the impurity and bath,
respectively; <span class="arithmatex">\(\varepsilon_{ij}\)</span> are the impurity levels,
<span class="arithmatex">\(V_{i \alpha}\)</span> the hybridization amplitudes, <span class="arithmatex">\(U_{ijkl}\)</span> the screened interaction tensor
and <span class="arithmatex">\(\delta \mu\)</span> the shift applied to the chemical potential at <span class="arithmatex">\(\lambda=0\)</span>.</p>
<p>At <span class="arithmatex">\(\lambda=1\)</span>, we recover the full physical impurity problem. At <span class="arithmatex">\(\lambda=0\)</span>, the
interaction term vanishes, so we end up with a non-interacting impurity model, whose free
energy is known analytically. Thermodynamic integration then yields the difference between
these two limits, by solving the impurity problem for several values of <span class="arithmatex">\(\lambda\)</span>.</p>
<p>To make the integration easier for CT-HYB, we also let the chemical potential vary linearly
with <span class="arithmatex">\(\lambda\)</span> - from its physical value <span class="arithmatex">\(\mu\)</span> at <span class="arithmatex">\(\lambda=1\)</span> to <span class="arithmatex">\(\mu + \delta \mu\)</span> at
<span class="arithmatex">\(\lambda=0\)</span>. The parameter <span class="arithmatex">\(\delta \mu\)</span> is set with <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_shift_mu">dmft_triqs_shift_mu</a>. Since CT-HYB
works best when the impurity is nearly empty or fully occupied (and struggles near half
filling), you should shift <span class="arithmatex">\(\mu\)</span> to push the system towards whichever limit is closest to
your <span class="arithmatex">\(\lambda=1\)</span> configuration. However, remember that if you shift the chemical potential
too much, the number of required integration points will increase.</p>
<p>With this setup, the impurity free energy becomes:
\begin{equation*}
F_{\text{imp}} = \text{Tr}[\log[\mathcal{G}_0]] + \int_0^1 [E_U + \delta \mu N]  d \lambda
\end{equation*}
where <span class="arithmatex">\(\mathcal{G}_0\)</span> is the Weiss field evaluated with the shifted chemical potential.</p>
<p>In order to perform the numerical integration over <span class="arithmatex">\(\lambda\)</span>, the interval <span class="arithmatex">\([0,1]\)</span> is
divided into <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_nsubdivisions">dmft_triqs_nsubdivisions</a> regular subdivisions. Each subinterval is then
integrated using a Gauss-Legendre quadrature of order <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_gaussorder">dmft_triqs_gaussorder</a>, for a
total number of integrations points of <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_nsubdivisions">dmft_triqs_nsubdivisions</a> <span class="arithmatex">\(\times\)</span>
<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_gaussorder">dmft_triqs_gaussorder</a>.</p>
<p>These two parameters must be converged carefully. A good strategy is to start with
<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_nsubdivisions">dmft_triqs_nsubdivisions</a><span class="arithmatex">\(=1\)</span> and then increase the Gauss-Legendre order. If the
integral becomes unstable, reduce the order and instead increase the number of
subdivisions.</p>
<p>Now, launch the next input file:</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>../tdmft_triqs_5.abi<span class="w"> </span>.
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>abinit<span class="w"> </span>tdmft_triqs_5.abi<span class="w"> </span>&gt;<span class="w"> </span>log5
</code></pre></div>
<div class="text-center"><button id="uuid-c91fd873-cb8e-406d-9dba-2d32d1fff075" class="md-button md-button--secondary"> View tests/tutoparal/Input/tdmft_triqs_5.abi </button></div>
<div id="uuid-23ebf915-4256-4ef9-bbae-594ba009e147" class="my_dialog" title="tests/tutoparal/Input/tdmft_triqs_5.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Multi_dataset parameters</span>
<span class="w"> </span>ndtset<span class="w"> </span><span class="m">2</span><span class="w">       </span><span class="c1"># Two datasets</span>
<span class="w"> </span>jdtset<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w">     </span><span class="c1"># one followed by two</span>
<span class="w"> </span>getden<span class="w"> </span>-1<span class="w">      </span><span class="c1"># Second one takes the density of first</span>

<span class="w"> </span>pawprtvol<span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="c1"># Printing additional information</span>
<span class="w"> </span>prtvol<span class="w"> </span><span class="m">4</span>

<span class="c1">############################</span>
<span class="c1"># Structural Parameters</span>
<span class="c1">############################</span>
<span class="c1">#Definition of unit cell</span>
<span class="w"> </span>acell<span class="w"> </span><span class="m">3</span>*5.44761<span class="w">       </span><span class="c1"># lattice parameter from J Phys. Condens. Matt</span>
<span class="w"> </span>rprim<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w">  </span><span class="c1"># Primitive cell</span>
<span class="w">        </span><span class="m">0</span>.5<span class="w"> </span>-0.5<span class="w">  </span><span class="m">0</span>.5
<span class="w">        </span><span class="m">0</span>.5<span class="w">  </span><span class="m">0</span>.5<span class="w"> </span>-0.5

<span class="c1">#Definition atom</span>
<span class="w"> </span>ntypat<span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="c1"># number of different types of atoms</span>
<span class="w"> </span>znucl<span class="w"> </span><span class="m">26</span><span class="w">   </span><span class="c1"># z number of atom</span>

<span class="c1">#Definition of the atoms</span>
<span class="w"> </span>natom<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># number of atoms</span>
<span class="w"> </span>typat<span class="w"> </span><span class="m">1</span><span class="w">           </span><span class="c1"># type of atom</span>
<span class="w"> </span>xred<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w">  </span><span class="c1"># reduced coordinates for primitive cell</span>

<span class="c1">#Definition pseudopotentials</span>
<span class="w"> </span>pp_dirpath<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span><span class="w">            </span><span class="c1"># repository with pseudopotentials</span>
<span class="w"> </span>pseudos<span class="w"> </span><span class="s2">&quot;26fe.lda2.paw&quot;</span>

<span class="c1">#Definition of the k-point grid</span>
<span class="w"> </span>kptopt<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>ngkpt<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w">              </span><span class="c1"># Reciprocal space vectors are built from</span>
<span class="w">                          </span><span class="c1"># the rprim parameters. This is the size of the</span>
<span class="w">                          </span><span class="c1"># reciprocal k-points.</span>
<span class="w"> </span>nshiftk<span class="w"> </span><span class="m">2</span><span class="w">                </span><span class="c1"># Convergence of the density with regular shifts.</span>
<span class="w"> </span>shiftk<span class="w"> </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25<span class="w">  </span><span class="m">0</span>.25
<span class="w">       </span>-0.25<span class="w"> </span>-0.25<span class="w"> </span>-0.25
<span class="w"> </span>istwfk<span class="w"> </span>*1

<span class="c1">############################</span>
<span class="c1"># Energy Parameters</span>
<span class="c1">############################</span>

<span class="w"> </span>ecut<span class="w"> </span><span class="m">20</span><span class="w">         </span><span class="c1"># Maximal plane-wave kinetic energy cut-off, in Hartree</span>
<span class="w"> </span>pawecutdg<span class="w"> </span><span class="m">40</span><span class="w">    </span><span class="c1"># PAW: Energy Cutoff for the Double Grid</span>
<span class="w"> </span>nband<span class="w"> </span><span class="m">20</span><span class="w">        </span><span class="c1"># Number of bands</span>
<span class="w"> </span>occopt<span class="w"> </span><span class="m">3</span><span class="w">        </span><span class="c1"># Smearing type</span>
<span class="w"> </span>tsmear<span class="w"> </span><span class="m">3000</span><span class="w"> </span>K<span class="w">   </span><span class="c1"># Electronic smearing temperature</span>

<span class="c1">############################</span>
<span class="c1"># DFT Calculation</span>
<span class="c1">############################</span>

<span class="w"> </span>nstep1<span class="w"> </span><span class="m">30</span><span class="w">        </span><span class="c1"># Number of iterations for the DFT convergence</span>
<span class="w"> </span>tolvrs1<span class="w"> </span><span class="m">1</span>.0d-12<span class="w">  </span><span class="c1"># Tolerance of the density for DFT convergence</span>

<span class="c1">#Definition of the spin properties</span>
<span class="w"> </span>nsppol<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># Spin polarized</span>
<span class="w"> </span>nspden<span class="w"> </span><span class="m">1</span><span class="w">     </span><span class="c1"># Collinear magnetism</span>
<span class="w"> </span>nspinor<span class="w"> </span><span class="m">1</span><span class="w">    </span><span class="c1"># No Spin-orbit</span>

<span class="c1">############################</span>
<span class="c1"># DMFT Calculation</span>
<span class="c1">############################</span>

<span class="w"> </span>usedmft2<span class="w">  </span><span class="m">1</span><span class="w">        </span><span class="c1"># DMFT calculation</span>
<span class="w"> </span>nstep2<span class="w">    </span><span class="m">1</span><span class="w">        </span><span class="c1"># Number of iterations for the DFT+DMFT convergence</span>
<span class="w"> </span>nline2<span class="w">    </span><span class="m">10</span><span class="w">       </span><span class="c1"># Number of line minimisations</span>
<span class="w"> </span>nnsclo2<span class="w">   </span><span class="m">10</span><span class="w">       </span><span class="c1"># Number of non-self consistent loops</span>
<span class="w"> </span>tolvrs2<span class="w">   </span><span class="m">1</span>.0d-12<span class="w">  </span><span class="c1"># Tolerance of the density for DFT+DMFT convergence</span>

<span class="c1">#Definition for DMFT loop</span>
<span class="w"> </span>dmftbandi<span class="w"> </span><span class="m">5</span><span class="w">             </span><span class="c1"># First KS band included in the projection for Wannier orbitals</span>
<span class="w"> </span>dmftbandf<span class="w"> </span><span class="m">13</span><span class="w">            </span><span class="c1"># Last KS band included in the projection for Wannier orbitals</span>
<span class="w"> </span>dmft_iter<span class="w"> </span><span class="m">1</span><span class="w">             </span><span class="c1"># Number of iterations of the DMFT part.</span>
<span class="w"> </span>dmft_dc<span class="w">   </span><span class="m">6</span><span class="w">             </span><span class="c1"># Exact double counting formula</span>
<span class="w"> </span>dmft_prtself<span class="w"> </span><span class="m">0</span><span class="w">          </span><span class="c1"># Do not print self-energy at each iteration</span>
<span class="w"> </span>dmft_prt_maxent<span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="c1"># Do not print files for analytical continuation</span>
<span class="w"> </span>dmft_mxsf<span class="w"> </span><span class="m">1</span>.0<span class="w">           </span><span class="c1"># Mixing parameter for self-energy</span>
<span class="w"> </span>dmft_triqs_entropy<span class="w"> </span><span class="m">1</span><span class="w">    </span><span class="c1"># Compute entropy</span>

<span class="w"> </span>dmft_triqs_compute_integral<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># Compute impurity entropy from thermodynamic integration</span>
<span class="w"> </span>dmft_triqs_gaussorder<span class="w"> </span><span class="m">5</span><span class="w">       </span><span class="c1"># Order of Gauss-Legendre quadrature for each subdivision</span>
<span class="w"> </span>dmft_triqs_nsubdivisions<span class="w"> </span><span class="m">1</span><span class="w">    </span><span class="c1"># Number of regular subdivisions of [0,1]</span>
<span class="w"> </span>dmft_triqs_shift_mu<span class="w"> </span><span class="m">0</span>.0<span class="w">       </span><span class="c1"># Target shift of the chemical potential</span>
<span class="w"> </span>dmft_triqs_prt_entropy<span class="w"> </span><span class="m">1</span><span class="w">      </span><span class="c1"># Print debug information for entropy calculation</span>

<span class="c1">#Definition of impurity solver</span>
<span class="w"> </span>dmft_solv<span class="w"> </span><span class="m">6</span><span class="w">                              </span><span class="c1"># TRIQS/CT-HYB solver in density-density approximation</span>
<span class="w"> </span>dmft_triqs_n_iw<span class="w"> </span><span class="m">500</span><span class="w">                      </span><span class="c1"># Number of Matsubara frequencies</span>
<span class="w"> </span>dmft_triqs_n_tau<span class="w"> </span><span class="m">200</span><span class="w">                     </span><span class="c1"># Number of imaginary time points</span>
<span class="w"> </span>dmft_triqs_n_cycles<span class="w"> </span><span class="m">250</span><span class="w">                  </span><span class="c1"># Number of measurement cycles</span>
<span class="w"> </span>dmft_triqs_n_warmup_cycles_init<span class="w">  </span><span class="m">100</span><span class="w">     </span><span class="c1"># Number of warmup cycles for initial iteration</span>
<span class="w"> </span>dmft_triqs_n_warmup_cycles_restart<span class="w"> </span><span class="m">0</span><span class="w">     </span><span class="c1"># Number of warmup cycles when restarting</span>
<span class="w"> </span>dmft_triqs_length_cycle<span class="w"> </span><span class="m">100</span><span class="w">              </span><span class="c1"># Length of a cycle</span>
<span class="w"> </span>dmft_triqs_basis<span class="w"> </span><span class="m">0</span><span class="w">                       </span><span class="c1"># Basis for CT-QMC</span>
<span class="w"> </span>dmft_triqs_off_diag<span class="w"> </span><span class="m">0</span><span class="w">                    </span><span class="c1"># Neglect off-diagonal elements</span>
<span class="w"> </span>dmft_triqs_dlr_wmax<span class="w"> </span><span class="m">30</span><span class="w"> </span>eV<span class="w">                </span><span class="c1"># Maximal frequency for DLR representation</span>
<span class="w"> </span>dmft_triqs_dlr_epsilon<span class="w"> </span><span class="m">1</span>.d-2<span class="w">             </span><span class="c1"># Accuracy of DLR representation</span>

<span class="c1">#Definition of interaction parameters</span>
<span class="w"> </span>usepawu1<span class="w">    </span><span class="m">4</span>
<span class="w"> </span>usepawu2<span class="w">    </span><span class="m">14</span><span class="w">          </span><span class="c1"># Non-magnetic XC potential</span>
<span class="w"> </span>lpawu<span class="w">       </span><span class="m">2</span><span class="w">           </span><span class="c1"># Angular momentum for the projected Hamiltonian</span>
<span class="w"> </span>upawu1<span class="w">      </span><span class="m">0</span>.00<span class="w"> </span>eV
<span class="w"> </span>upawu2<span class="w">      </span><span class="m">5</span>.5<span class="w">  </span>eV<span class="w">     </span><span class="c1"># Values of U for each angular momentum</span>
<span class="w"> </span>jpawu2<span class="w">      </span><span class="m">0</span>.84<span class="w"> </span>eV<span class="w">     </span><span class="c1"># Values of J</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-23ebf915-4256-4ef9-bbae-594ba009e147", "#uuid-c91fd873-cb8e-406d-9dba-2d32d1fff075") }); </script>

<p>The free energy contributions are collected in <code>log5</code>:</p>
<div class="highlight"><pre><span></span><code><span class="w">     </span>-----------------------------------------------
<span class="w">     </span>---<span class="w"> </span>Free<span class="w"> </span>Energy<span class="w"> </span><span class="k">in</span><span class="w"> </span>DMFT<span class="w"> </span><span class="o">(</span><span class="k">in</span><span class="w"> </span>Ha<span class="o">)</span>
<span class="w">     </span>---<span class="w"> </span>E_hu<span class="w">                      </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">        </span><span class="m">2</span>.75967110404
<span class="w">     </span>---<span class="w"> </span>E_dc<span class="w">                      </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">        </span><span class="m">2</span>.95732754743
<span class="w">     </span>---<span class="w"> </span>E_dmft<span class="w">                </span><span class="o">(</span><span class="m">1</span><span class="o">)</span>-<span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">       </span>-0.19765644339
<span class="w">     </span>---<span class="w"> </span>Tr<span class="o">(</span>log<span class="o">(</span>G<span class="o">))</span>+mu*N<span class="w">           </span><span class="o">(</span><span class="m">3</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">      </span>-13.89083286268
<span class="w">     </span>---<span class="w"> </span>Tr<span class="o">(</span>Sigma*G<span class="o">)</span><span class="w">               </span><span class="o">(</span><span class="m">4</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">        </span><span class="m">5</span>.67139741915
<span class="w">     </span>---<span class="w"> </span>Tr<span class="o">(</span>V_dc*rho<span class="o">)</span><span class="w">              </span><span class="o">(</span><span class="m">5</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">        </span><span class="m">5</span>.91465509486
<span class="w">     </span>---<span class="w"> </span>E_band_dmft<span class="w">               </span><span class="o">(</span><span class="m">6</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">      </span>-13.43211956698
<span class="w">     </span>---<span class="w"> </span>Tr<span class="o">(</span>log<span class="o">(</span>Gimp<span class="o">))</span><span class="w">             </span><span class="o">(</span><span class="m">7</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">       </span>-1.00797988424
<span class="w">     </span>---<span class="w"> </span>Tr<span class="o">(</span>Sigma_imp*G_imp<span class="o">)</span><span class="w">       </span><span class="o">(</span><span class="m">8</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">        </span><span class="m">5</span>.55811370252
<span class="w">     </span>---<span class="w"> </span>E_kinetic_imp<span class="w">             </span><span class="o">(</span><span class="m">9</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">       </span>-6.45635618493
<span class="w">     </span>---<span class="w"> </span>Tr<span class="o">(</span>log<span class="o">(</span>G0<span class="o">))</span><span class="w">              </span><span class="o">(</span><span class="m">10</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">      </span>-10.29291902071
<span class="w">     </span>---<span class="w"> </span>Integral<span class="w">                 </span><span class="o">(</span><span class="m">11</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">        </span><span class="m">6</span>.57805158146
<span class="w">     </span>---<span class="w"> </span>F_imp<span class="w">               </span><span class="o">(</span><span class="m">10</span><span class="o">)</span>+<span class="o">(</span><span class="m">11</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">       </span>-3.71486743925
<span class="w">     </span>---<span class="w"> </span><span class="o">(</span>-kT<span class="o">)</span>*S_imp<span class="w"> </span><span class="o">(</span><span class="m">10</span><span class="o">)</span>+<span class="o">(</span><span class="m">11</span><span class="o">)</span>-<span class="o">(</span><span class="m">9</span><span class="o">)</span>-<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">       </span>-0.01818235837
<span class="w">     </span>---<span class="w"> </span>S_imp<span class="w">                    </span><span class="o">(</span><span class="m">12</span><span class="o">)</span><span class="w">       </span><span class="o">=</span><span class="w">        </span><span class="m">1</span>.91384255763
<span class="w">     </span>---<span class="w"> </span>F_dmft<span class="w">                   </span><span class="o">(</span><span class="m">13</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">       </span>-0.32155701991
<span class="w">     </span>---<span class="w"> </span><span class="o">(</span>-kT<span class="o">)</span>*S_dmft<span class="w">     </span><span class="o">(</span><span class="m">13</span><span class="o">)</span>-<span class="o">(</span><span class="m">1</span><span class="o">)</span>+<span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="o">(</span>Ha.<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">       </span>-0.12390057652
<span class="w">     </span>---<span class="w"> </span><span class="nv">S_dmft</span><span class="w">                              </span><span class="o">=</span><span class="w">       </span><span class="m">13</span>.04155332714
<span class="w">     </span>-----------------------------------------------
</code></pre></div>
<p>A more compact summary is also printed:</p>
<div class="highlight"><pre><span></span><code>---<span class="w"> </span>!EntropyTerms
iteration_state<span class="w">     </span>:<span class="w"> </span><span class="o">{</span>dtset:<span class="w"> </span><span class="m">2</span>,<span class="w"> </span><span class="o">}</span>
comment<span class="w">             </span>:<span class="w"> </span>Components<span class="w"> </span>of<span class="w"> </span>total<span class="w"> </span>entropy
noninteracting<span class="w">      </span>:<span class="w">  </span><span class="m">1</span>.11277107695086E+01
impurity<span class="w">            </span>:<span class="w">  </span><span class="m">1</span>.91384255762933E+00
total_entropy<span class="w">       </span>:<span class="w">  </span><span class="m">1</span>.30415533271379E+01
...
</code></pre></div>
<p>Here, <code>noninteracting</code> corresponds to <span class="arithmatex">\(S_{\text{DFT+DMFT}}-S_{\text{imp}}\)</span>, and
<code>impurity</code> is <span class="arithmatex">\(S_{\text{imp}}\)</span> itself. This summary is only printed when the impurity
entropy is computed (<a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_compute_integral">dmft_triqs_compute_integral</a><span class="arithmatex">\(=1\)</span>; otherwise <code>ETOT</code> only contains
the internal energy, as neglecting <span class="arithmatex">\(S_{\text{imp}}\)</span> is not physically meaningful).</p>
<p>This example is not a physical calculation: we performed only one iteration and used
extremely loose parameters. A real free-energy calculation requires a fully converged
charge self-consistent DMFT cycle, and the free-energy calculation is then restarted from
that, with many more Monte Carlo sweeps, and carefully converged thermodynamic integration
parameters.</p>
<p>Since CT-HYB must be run at each integration point, correctly choosing the chemical
potential shift and the number of points is crucial; both strongly affect the total run
time. The summary is displayed here:</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="o">=======================================</span>
<span class="w">   </span><span class="o">==</span><span class="w"> </span>Summary<span class="w"> </span>of<span class="w"> </span>thermodynamic<span class="w"> </span><span class="nv">integration</span>
<span class="w">   </span><span class="o">=======================================</span>
</code></pre></div>
<p>To assist with this tuning, you can enable <a class="wikilink codevar-wikilink" href="/variables/dmft#dmft_triqs_prt_entropy">dmft_triqs_prt_entropy</a>, which prints
diagnostic information (occupancies, Green&rsquo;s functions, histograms) for each value of
<span class="arithmatex">\(\lambda\)</span>. Be aware that this might increase CT-HYB measurement time.</p>







  
  






                

<!--
Add dropdown button with toolbar (based on https://bootsnipp.com/snippets/featured/inbox-by-gmail)
and return to Top button (based on https://codepen.io/rdallaire/pen/apoyx)
-->
<div class="md-container">
  <div class="row">
    <div id="inbox">
      <div class="fab btn-group show-on-hover dropup">
        <div data-toggle="tooltip" data-placement="left" title="Menu" style="margin-left: 42px;">
          <button id="return-to-top" type="button" class="btn btn-primary btn-io dropdown-toggle" data-toggle="dropdown">
            <span class="fa-stack fa-2x">
               <i class="fa fa-circle fa-stack-2x fab-backdrop"></i>
               <i class="fa fa-chevron-up fa-stack-1x fa-inverse fab-primary"></i>
               <i class="fa fa-map-signs fa-stack-1x fa-inverse fab-secondary"></i>
            </span>
          </button>
        </div>
        <ul class="dropdown-menu dropdown-menu-right" role="menu">
        
        
          <li>
            <a href="https://docs.abinit.org/about/release-notes/"
               data-toggle="popover" data-tippy-content="About">
               <i class="fa fa-info-circle"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/developers/git_and_gitlab/"
               data-toggle="popover" data-tippy-content="Developers">
               <i class="fa fa-terminal"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/theory/geometry/"
               data-toggle="popover" data-tippy-content="Theory">
               <i class="fa fa-book"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/faq/configuration_and_compilation/"
               data-toggle="popover" data-tippy-content="FAQ">
               <i class="fa fa-graduation-cap"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/tutorial/"
               data-toggle="popover" data-tippy-content="Tutorials">
               <i class="fa fa-file-text-o"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/variables/"
               data-toggle="popover" data-tippy-content="Variables">
               <i class="fa fa-question"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/topics/features/"
               data-toggle="popover" data-tippy-content="Topics">
               <i class="fa fa-user-circle-o"></i>
            </a>
          </li>
        
          <li>
            <a href=""
               data-toggle="popover" data-tippy-content="User Guides">
               <i class="fa "></i>
            </a>
          </li>
        
        </ul>
      </div>
    </div>
  </div>
</div>

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="footer.title">
      
        <a href="../dmft/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              DMFT
            </div>
          </div>
        </a>
      
      
        <a href="../tddft/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              TDDFT (Casida)
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
            <center>Abinit version 10.5.8</center>
        
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020-2024 The Abinit Group
            
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/abinit/abinit" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/watch?v=gcbfb_Mteo4" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="http://www.facebook.com/abinit.org" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/hashtag/abinit" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "header.autohide"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": "10.5.8"}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../extra_javascript/abidocs.js"></script>
      
    
  </body>
</html>